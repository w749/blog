<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="Oozie-入门基础"><meta name="keywords" content="Oozie"><meta name="author" content="WangXun"><meta name="copyright" content="WangXun"><title>Oozie-入门基础 | Wake</title><link rel="shortcut icon" href="/img/favicon-blank.svg"><link rel="stylesheet" href="/css/index.css?version=1.9.1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.1"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.css"><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.js" defer></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js"></script><script src="https://cdn.jsdelivr.net/npm/blueimp-md5@2.10.0/js/md5.min.js"></script><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://v1.hitokoto.cn/?encode=js&amp;charset=utf-8&amp;select=.footer_custom_text" defer></script><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: {"appId":"HSM2EINL2X","apiKey":"6f1478b12150efd917d5ecfcddfb8b8b","indexName":"wangxun","hits":{"per_page":10},"languages":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}.","hits_stats":"${hits} results found in ${time} ms"}},
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  hexoVersion: '6.0.0'
} </script><meta name="generator" content="Hexo 6.0.0"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Command"><span class="toc-number">1.</span> <span class="toc-text">Command</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Workflow"><span class="toc-number">2.</span> <span class="toc-text">Workflow</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Control-flow-nodes"><span class="toc-number">2.1.</span> <span class="toc-text">Control flow nodes</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Action-nodes"><span class="toc-number">2.2.</span> <span class="toc-text">Action nodes</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Coordinator"><span class="toc-number">3.</span> <span class="toc-text">Coordinator</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%8D%E8%A6%81%E5%AE%9A%E4%B9%89"><span class="toc-number">3.1.</span> <span class="toc-text">重要定义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Control"><span class="toc-number">3.2.</span> <span class="toc-text">Control</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Dataset"><span class="toc-number">3.3.</span> <span class="toc-text">Dataset</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Extra"><span class="toc-number">4.</span> <span class="toc-text">Extra</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Expression-Language-Functions"><span class="toc-number">4.1.</span> <span class="toc-text">Expression Language Functions</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Workflow-Lifecycle"><span class="toc-number">4.2.</span> <span class="toc-text">Workflow Lifecycle</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%B1%E8%B4%A5%E9%87%8D%E8%AF%95"><span class="toc-number">4.3.</span> <span class="toc-text">失败重试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E5%8F%AF%E4%BB%A5%E8%A7%A3%E6%9E%90UTC-8%E6%97%B6%E5%8C%BA"><span class="toc-number">4.4.</span> <span class="toc-text">配置可以解析UTC+8时区</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B"><span class="toc-number">5.</span> <span class="toc-text">示例</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/img/avatar.jpg"></div><div class="author-info__name text-center">WangXun</div><div class="author-info__description text-center"></div><div class="follow-button"><a target="_blank" rel="noopener" href="https://github.com/w749">Follow Me</a></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">71</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">20</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">Categories</span><span class="pull-right">6</span></a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(/img/top-img.jpg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Wake</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span><span class="pull-right"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> Search</span></a></span></div><div id="post-info"><div id="post-title">Oozie-入门基础</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2022-04-20</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/Software/">Software</a><div class="post-meta-wordcount"><span>Word count: </span><span class="word-count">5.4k</span><span class="post-meta__separator">|</span><span>Reading time: 24 min</span></div></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><p>Oozie基础命令和Workflow以及Coordinator的简单配置</p>
<span id="more"></span>

<h2 id="Command"><a href="#Command" class="headerlink" title="Command"></a>Command</h2><p>oozie常用命令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">启动oozie</span></span><br><span class="line">bin/oozied.sh start</span><br><span class="line"><span class="meta"># </span><span class="language-bash">停止oozie</span></span><br><span class="line">bin/oozied.sh stop</span><br><span class="line"><span class="meta"># </span><span class="language-bash">访问页面</span></span><br><span class="line">curl http://localhost:11000/oozie/</span><br><span class="line"><span class="meta"># </span><span class="language-bash">提交并运行作业，job.properties在本地，全局配置文件，可在workflow和coordinator中使用</span></span><br><span class="line">oozie job -oozie http://localhost:11000/oozie -config job.properties -run</span><br><span class="line"><span class="meta"># </span><span class="language-bash">杀死作业，<span class="built_in">kill</span>后接jobID</span></span><br><span class="line">oozie job -oozie http://localhost:11000/oozie -kill 0000411-180116183039102-oozie-hado-W</span><br><span class="line"><span class="meta"># </span><span class="language-bash">查看作业状态</span></span><br><span class="line">oozie job -oozie http://localhost:11000/oozie -info 0000411-180116183039102-oozie-hado-W</span><br><span class="line"><span class="meta"># </span><span class="language-bash">查看日志</span></span><br><span class="line">oozie job -oozie http://localhost:11000/oozie -log 0000411-180116183039102-oozie-hado-W</span><br><span class="line"><span class="meta"># </span><span class="language-bash">查看配置文件</span></span><br><span class="line">oozie job -oozie http://localhost:11000/oozie -configcontent 0000411-180116183039102-oozie-hado-W</span><br><span class="line"><span class="meta"># </span><span class="language-bash">重跑workflow任务</span></span><br><span class="line">oozie job -oozie http://localhost:11000/oozie -rerun 0000411-180116183039102-oozie-hado-W -config workflow.xml</span><br><span class="line"><span class="meta"># </span><span class="language-bash">重跑coordinator任务，action后跟coordinator每次任务<span class="built_in">id</span>中@后的数字</span></span><br><span class="line">oozie job -oozie http://localhost:11000/oozie -rerun 0000411-180116183039102-oozie-hado-C -refresh -action 1</span><br><span class="line"><span class="meta"># </span><span class="language-bash">检查workflow是否合规</span></span><br><span class="line">oozie validate -oozie http://localhost:11000/oozie myApp/workflow.xml</span><br><span class="line"><span class="meta"># </span><span class="language-bash">查看所有任务</span></span><br><span class="line">oozie jobs -oozie http://localhost:11000/oozie</span><br><span class="line"><span class="meta"># </span><span class="language-bash">查看coordinator任务</span></span><br><span class="line">oozie jobs -oozie http://localhost:11000/oozie -jobtype coordinator</span><br><span class="line"><span class="meta"># </span><span class="language-bash">列出所有的ShareLib信息</span></span><br><span class="line">oozie admin -oozie http://localhost:11000/oozie -shareliblist</span><br><span class="line"><span class="meta"># </span><span class="language-bash">列出指定的ShareLib服务信息</span></span><br><span class="line">oozie admin -oozie http://localhost:11000/oozie -shareliblist spark</span><br><span class="line"><span class="meta"># </span><span class="language-bash">自动切换到最新的ShareLib目录</span></span><br><span class="line">oozie admin -oozie http://localhost:11000/oozie -sharelibupdate</span><br></pre></td></tr></table></figure>

<h2 id="Workflow"><a href="#Workflow" class="headerlink" title="Workflow"></a>Workflow</h2><h3 id="Control-flow-nodes"><a href="#Control-flow-nodes" class="headerlink" title="Control flow nodes"></a>Control flow nodes</h3><p>流程控制节点分为两类，一类是start、kill、end等定义流程开始结束的节点；一类是decision、fork、join等提供控制流程执行路径的节点<br>配置文件所有的变量都可以通过命令行提交任务时指定<code>-D name_node=hdfs://localhost:8020</code>传入<br>job-tracker和name-node标签分别对应yarn的server地址和hdfs namenode的地址</p>
<ol>
<li>start、kill、end节点<br>start和end是必须指定的节点，end标识流程success，kill标识流程failed<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">workflow-app</span> <span class="attr">name</span>=<span class="string">&quot;foo-wf&quot;</span> <span class="attr">xmlns</span>=<span class="string">&quot;uri:oozie:workflow:0.1&quot;</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 流程启动时执行的node名称 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">start</span> <span class="attr">to</span>=<span class="string">&quot;firstHadoopJob&quot;</span>/&gt;</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">&lt;!-- 流程执行失败时指向kill node，那么oozie就会标记流程失败，不会再执行后续的流程 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">kill</span> <span class="attr">name</span>=<span class="string">&quot;kill&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">message</span>&gt;</span>Action failed, error message[$&#123;wf:errorMessage(wf:lastErrorNode())&#125;]<span class="tag">&lt;/<span class="name">message</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">kill</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 指向end node表示流程执行成功从而执行下一个流程 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">end</span> <span class="attr">name</span>=<span class="string">&quot;end&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">workflow-app</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>decision<br>相当于case when语法，条件返回true时执行对应指定的node，否则就会执行default默认的node<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">workflow-app</span> <span class="attr">name</span>=<span class="string">&quot;foo-wf&quot;</span> <span class="attr">xmlns</span>=<span class="string">&quot;uri:oozie:workflow:0.1&quot;</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="tag">&lt;<span class="name">decision</span> <span class="attr">name</span>=<span class="string">&quot;mydecision&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">switch</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">case</span> <span class="attr">to</span>=<span class="string">&quot;reconsolidatejob&quot;</span>&gt;</span></span><br><span class="line">              $&#123;fs:fileSize(secondjobOutputDir) gt 10 * GB&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">case</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">case</span> <span class="attr">to</span>=<span class="string">&quot;rexpandjob&quot;</span>&gt;</span></span><br><span class="line">              $&#123;fs:filSize(secondjobOutputDir) lt 100 * MB&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">case</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">case</span> <span class="attr">to</span>=<span class="string">&quot;recomputejob&quot;</span>&gt;</span></span><br><span class="line">              $&#123; hadoop:counters(&#x27;secondjob&#x27;)[RECORDS][REDUCE_OUT] lt 1000000 &#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">case</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">default</span> <span class="attr">to</span>=<span class="string">&quot;end&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">switch</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">decision</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">workflow-app</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>fork、join<br>fork和join必须同时使用，fork指定可以并行执行的流程，所有流程执行完成后汇聚到join才会执行下一个流程，可以多个fork和join嵌套使用。下面的例子就是firstparalleljob和secondparalleljob同时执行，都执行成功后汇聚到joining再执行nextaction<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">workflow-app</span> <span class="attr">name</span>=<span class="string">&quot;sample-wf&quot;</span> <span class="attr">xmlns</span>=<span class="string">&quot;uri:oozie:workflow:0.1&quot;</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="tag">&lt;<span class="name">fork</span> <span class="attr">name</span>=<span class="string">&quot;forking&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">path</span> <span class="attr">start</span>=<span class="string">&quot;firstparalleljob&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">path</span> <span class="attr">start</span>=<span class="string">&quot;secondparalleljob&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">fork</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">&quot;firstparallejob&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">map-reduce</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">job-tracker</span>&gt;</span>foo:8021<span class="tag">&lt;/<span class="name">job-tracker</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name-node</span>&gt;</span>bar:8020<span class="tag">&lt;/<span class="name">name-node</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">job-xml</span>&gt;</span>job1.xml<span class="tag">&lt;/<span class="name">job-xml</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">map-reduce</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ok</span> <span class="attr">to</span>=<span class="string">&quot;joining&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">error</span> <span class="attr">to</span>=<span class="string">&quot;kill&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">&quot;secondparalleljob&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">map-reduce</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">job-tracker</span>&gt;</span>foo:8021<span class="tag">&lt;/<span class="name">job-tracker</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name-node</span>&gt;</span>bar:8020<span class="tag">&lt;/<span class="name">name-node</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">job-xml</span>&gt;</span>job2.xml<span class="tag">&lt;/<span class="name">job-xml</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">map-reduce</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ok</span> <span class="attr">to</span>=<span class="string">&quot;joining&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">error</span> <span class="attr">to</span>=<span class="string">&quot;kill&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">join</span> <span class="attr">name</span>=<span class="string">&quot;joining&quot;</span> <span class="attr">to</span>=<span class="string">&quot;nextaction&quot;</span>/&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">workflow-app</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="Action-nodes"><a href="#Action-nodes" class="headerlink" title="Action nodes"></a>Action nodes</h3><p>action node是由oozie分发到不同的yarn节点去完成的，当执行成功返回到ok继续下个流程，当执行失败返回到error执行下个流程，可以指定到kill或者忽略错误正常指定到下个流程<br>oozie提供了失败重试的功能，它会在失败后一定时间内重新执行，间隔的时间和重试次数都需要在外部指定<br>下面选择几种常用的流程配置文件</p>
<ol>
<li>HDFS<br>oozie只提供了这几种简单的文件操作命令，configuration.property可以传入hdfs相关的配置，影响下面命令的执行<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">workflow-app</span> <span class="attr">name</span>=<span class="string">&quot;sample-wf&quot;</span> <span class="attr">xmlns</span>=<span class="string">&quot;uri:oozie:workflow:0.5&quot;</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">&quot;hdfscommands&quot;</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">fs</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name-node</span>&gt;</span>hdfs://foo:8020<span class="tag">&lt;/<span class="name">name-node</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">name</span>&gt;</span>some.property<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>some.value<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">delete</span> <span class="attr">path</span>=<span class="string">&#x27;/usr/tucu/temp-data&#x27;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">mkdir</span> <span class="attr">path</span>=<span class="string">&#x27;archives/$&#123;wf:id()&#125;&#x27;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">move</span> <span class="attr">source</span>=<span class="string">&#x27;$&#123;jobInput&#125;&#x27;</span> <span class="attr">target</span>=<span class="string">&#x27;archives/$&#123;wf:id()&#125;/processed-input&#x27;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">chmod</span> <span class="attr">path</span>=<span class="string">&#x27;$&#123;jobOutput&#125;&#x27;</span> <span class="attr">permissions</span>=<span class="string">&#x27;-rwxrw-rw-&#x27;</span> <span class="attr">dir-files</span>=<span class="string">&#x27;true&#x27;</span>&gt;</span><span class="tag">&lt;<span class="name">recursive</span>/&gt;</span><span class="tag">&lt;/<span class="name">chmod</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">chgrp</span> <span class="attr">path</span>=<span class="string">&#x27;$&#123;jobOutput&#125;&#x27;</span> <span class="attr">group</span>=<span class="string">&#x27;testgroup&#x27;</span> <span class="attr">dir-files</span>=<span class="string">&#x27;true&#x27;</span>&gt;</span><span class="tag">&lt;<span class="name">recursive</span>/&gt;</span><span class="tag">&lt;/<span class="name">chgrp</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">fs</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ok</span> <span class="attr">to</span>=<span class="string">&quot;myotherjob&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">error</span> <span class="attr">to</span>=<span class="string">&quot;errorcleanup&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">workflow-app</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>SSH<br>如果需要在指定的服务器运行命令那么ssh相对shell是个更好的选择，它会先登录目标服务器再执行命令，前提是可以免密登录<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">workflow-app</span> <span class="attr">name</span>=<span class="string">&quot;sample-wf&quot;</span> <span class="attr">xmlns</span>=<span class="string">&quot;uri:oozie:workflow:0.1&quot;</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">&quot;myssjob&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ssh</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">host</span>&gt;</span>localhost:22<span class="tag">&lt;<span class="name">host</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">command</span>&gt;</span>chmod<span class="tag">&lt;/<span class="name">command</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">args</span>&gt;</span>-R<span class="tag">&lt;/<span class="name">args</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">args</span>&gt;</span>777<span class="tag">&lt;/<span class="name">args</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">args</span>&gt;</span>/home/root/*<span class="tag">&lt;/<span class="name">args</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ssh</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ok</span> <span class="attr">to</span>=<span class="string">&quot;myotherjob&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">error</span> <span class="attr">to</span>=<span class="string">&quot;errorcleanup&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">workflow-app</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>Java<br>运行java程序相当于hadoop jar…命令，注意jar包要放在和workflow.xml相同路径的lib文件夹下，或者使用archive指定<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">workflow-app</span> <span class="attr">name</span>=<span class="string">&quot;sample-wf&quot;</span> <span class="attr">xmlns</span>=<span class="string">&quot;uri:oozie:workflow:0.1&quot;</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">&quot;myfirstjavajob&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">job-tracker</span>&gt;</span>foo:8021<span class="tag">&lt;/<span class="name">job-tracker</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name-node</span>&gt;</span>bar:8020<span class="tag">&lt;/<span class="name">name-node</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">prepare</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">delete</span> <span class="attr">path</span>=<span class="string">&quot;$&#123;jobOutput&#125;&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">prepare</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapred.queue.name<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">value</span>&gt;</span>default<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">main-class</span>&gt;</span>org.apache.oozie.MyFirstMainClass<span class="tag">&lt;/<span class="name">main-class</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">java-opts</span>&gt;</span>-Dblah<span class="tag">&lt;/<span class="name">java-opts</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">arg</span>&gt;</span>argument1<span class="tag">&lt;/<span class="name">arg</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">arg</span>&gt;</span>argument2<span class="tag">&lt;/<span class="name">arg</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">java</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ok</span> <span class="attr">to</span>=<span class="string">&quot;myotherjob&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">error</span> <span class="attr">to</span>=<span class="string">&quot;errorcleanup&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">workflow-app</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>Sqoop<br>直接在command标签内写入sqoop后的所有命令和参数即可<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">workflow-app</span> <span class="attr">name</span>=<span class="string">&quot;sample-wf&quot;</span> <span class="attr">xmlns</span>=<span class="string">&quot;uri:oozie:workflow:0.1&quot;</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">&quot;myfirsthivejob&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">sqoop</span> <span class="attr">xmlns</span>=<span class="string">&quot;uri:oozie:sqoop-action:0.2&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">job-traker</span>&gt;</span>foo:8021<span class="tag">&lt;/<span class="name">job-tracker</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name-node</span>&gt;</span>bar:8020<span class="tag">&lt;/<span class="name">name-node</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">prepare</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">delete</span> <span class="attr">path</span>=<span class="string">&quot;$&#123;jobOutput&#125;&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">prepare</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapred.compress.map.output<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">command</span>&gt;</span>import --connect jdbc:hsqldb:file:db.hsqldb --table TT --target-dir hdfs://localhost:8020/user/tucu/foo -m 1<span class="tag">&lt;/<span class="name">command</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">sqoop</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ok</span> <span class="attr">to</span>=<span class="string">&quot;myotherjob&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">error</span> <span class="attr">to</span>=<span class="string">&quot;errorcleanup&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">workflow-app</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>Spark<br>除了master、node、name和class参数外其它参数都可以放到spark-opts中<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">workflow-app</span> <span class="attr">name</span>=<span class="string">&quot;sample-wf&quot;</span> <span class="attr">xmlns</span>=<span class="string">&quot;uri:oozie:workflow:0.1&quot;</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">&quot;sparkJob&quot;</span>&gt;</span></span><br><span class="line">	    <span class="tag">&lt;<span class="name">spark</span> <span class="attr">xmlns</span>=<span class="string">&quot;uri:oozie:spark-action:0.1&quot;</span>&gt;</span></span><br><span class="line">	        <span class="tag">&lt;<span class="name">job-tracker</span>&gt;</span>$&#123;job_tracker&#125;<span class="tag">&lt;/<span class="name">job-tracker</span>&gt;</span></span><br><span class="line">	        <span class="tag">&lt;<span class="name">name-node</span>&gt;</span>$&#123;name_node&#125;<span class="tag">&lt;/<span class="name">name-node</span>&gt;</span></span><br><span class="line">	        <span class="tag">&lt;<span class="name">prepare</span>&gt;</span></span><br><span class="line">	            <span class="tag">&lt;<span class="name">delete</span> <span class="attr">path</span>=<span class="string">&quot;$&#123;output&#125;&quot;</span>/&gt;</span></span><br><span class="line">	        <span class="tag">&lt;/<span class="name">prepare</span>&gt;</span></span><br><span class="line">	        <span class="tag">&lt;<span class="name">master</span>&gt;</span>yarn-cluster<span class="tag">&lt;/<span class="name">master</span>&gt;</span></span><br><span class="line">	        <span class="tag">&lt;<span class="name">mode</span>&gt;</span>cluster<span class="tag">&lt;/<span class="name">mode</span>&gt;</span></span><br><span class="line">	        <span class="tag">&lt;<span class="name">name</span>&gt;</span>spark-test<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">	        <span class="tag">&lt;<span class="name">class</span>&gt;</span>com.hh.anta.analyzer.jobs.statreport.backbone.LargeIpAnalysis<span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br><span class="line">	        <span class="tag">&lt;<span class="name">jar</span>&gt;</span>$&#123;jar_path&#125;<span class="tag">&lt;/<span class="name">jar</span>&gt;</span></span><br><span class="line">	        <span class="tag">&lt;<span class="name">spark-opts</span>&gt;</span>--num-executors 4 --executor-memory 10g --executor-cores 2 --driver-memory 2g<span class="tag">&lt;/<span class="name">spark-opts</span>&gt;</span></span><br><span class="line">	        <span class="tag">&lt;<span class="name">arg</span>&gt;</span>$&#123;input&#125;<span class="tag">&lt;/<span class="name">arg</span>&gt;</span></span><br><span class="line">	        <span class="tag">&lt;<span class="name">arg</span>&gt;</span>$&#123;output&#125;<span class="tag">&lt;/<span class="name">arg</span>&gt;</span></span><br><span class="line">	    <span class="tag">&lt;/<span class="name">spark</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">workflow-app</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="Coordinator"><a href="#Coordinator" class="headerlink" title="Coordinator"></a>Coordinator</h2><p>Coordinator是用来执行Workflow工作流的周期性调度工作，它和workflow一样采用xml配置文件的方式配置工作流，有关它的例子可以查看<a target="_blank" rel="noopener" href="https://www.aboutyun.com//forum.php/?mod=viewthread&tid=7721&extra=page=1&page=1&">示例</a></p>
<h3 id="重要定义"><a href="#重要定义" class="headerlink" title="重要定义"></a>重要定义</h3><ul>
<li>Actual time实际时间：指某事实际发生的时间</li>
<li>Nominal time理论时间：指某事理论上发生的时间。理论上它和实际时间应该匹配，但在实际中由于延迟，实际时间可能会发生晚于理论时间</li>
<li>Dataset数据集：它为工作流提供数据目录，一般是HDFS上的路径。一个Datasets通常有几个Dataset实例，每个实例都可以被单独引用</li>
<li>Synchronous Dataset同步数据集：它以固定的时间间隔生成，每个时间间隔都有一个关联的数据集实例。同步数据集实例由它们的理论时间标识</li>
<li>Coordinator Action协调器操作：它是一种工作流，它在满足一组条件时启动(输入Dataset实例可用)</li>
<li>Coordinator Application协调器应用程序：它定义了创建Coordinator Action的条件(频率)以及启动action的时间。同时还定义了开始时间和结束时间</li>
<li>Coordinator Job协调作业：它是协调定义的可执行实例。作业提交是通过提交作业配置来完成的，该配置解析应用程序定义中的所有参数</li>
<li>Data pipeline数据管道：它是一组使用和产生相互依赖的Dataset的Coordinator Application的管道</li>
<li>Coordinator Definition Language协调器定义语言：用于描述Dataset和Coordinator Application的语言</li>
<li>Coordinator Engine协调器引擎：执行Coordinator Job的系统</li>
</ul>
<h3 id="Control"><a href="#Control" class="headerlink" title="Control"></a>Control</h3><p>定义了一个Coordinator Job的控制信息，主要包括如下三个配置元素</p>
<ol>
<li>timeout<br>超时时间，单位为分钟。当一个Coordinator Job启动的时候，会初始化多个Coordinator动作，timeout用来限制这个初始化过程。默认值为-1，表示永远不超时</li>
<li>concurrency<br>并发数，指多个Coordinator Job并发执行，默认值为1</li>
<li>execution<br>配置多个Coordinator Job并发执行的策略：默认是FIFO。另外还有两种：LIFO（最新的先执行）、LAST_ONLY（只执行最新的Coordinator Job，其它的全部丢弃）</li>
</ol>
<h3 id="Dataset"><a href="#Dataset" class="headerlink" title="Dataset"></a>Dataset</h3><p>定义了一个hdfs uri，通过频率和开始时间周期性的生成hdfs目录</p>
<ol>
<li>name<br>Dataset名称</li>
<li>frequency<br>频率用来指定同一工作流执行的时间间隔，oozie提供了几种内置的方法用来指定间隔<ul>
<li><code>$&#123;coord:minutes(int n)&#125;</code>，单位为分钟的时间间隔</li>
<li><code>$&#123;coord:hours(int n)&#125;</code>，单位为小时的时间间隔</li>
<li><code>$&#123;coord:days(int n)&#125;</code>，单位为天的时间间隔</li>
<li><code>$&#123;coord:months(int n)&#125;</code>，单位为月的时间间隔</li>
<li><code>$&#123;cron syntax&#125;</code>，使用crontab表达式，例如<code>$&#123;0,10 15 * * 2-6&#125;</code></li>
</ul>
</li>
<li>initial-instance<br>工作流启动的初始时间，它会根据初始时间和frequency周期性的执行工作流。注意格式需要跟timezone相匹配</li>
<li>timezone<br>Oozie的默认处理时区是UTC，一般要将它修改为当地的时区，oozie支持两种方式，分别是<code>GMT[+/-]##:## (eg: GMT+05:30)</code>和<code>Zoneinfo标识(eg: Asia/Shanghai)</code>。而且需要注意oozie中的datatime是要根据timezone来指定的（eg：timezone设为GMT+8:00，那么开始时间的格式就是2019-10-1T00:00+0800）</li>
<li>uri-template<br>定义的是hdfs上的路径模板，因为是周期性的存储数据，那么保存的目录就应该是动态生成的<br>路径模板由常量和变量组成，常量是你自己提供的，变量是oozie提供的几个时间度量值，用来获取当前的时间，分别是<code>YEAR、MONTH、DAY、HOUR、MINUTE</code>，对应输出的格式为<code>YYYYMMDDHHmm</code></li>
<li>done-flag<br>工作流完成标识符，用来告诉oozie什么情况下认为当前任务已完成，给它指定不同的值将代表不同的含义：不指定标签时当目录下出现_SUCCESS文件那么标记任务成功；指定标签但值为空时只要当前文件夹存在即为成功；指定标签并且指定值那么只有文件夹下出现指定值的文件时才会标记成功<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">datasets</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">include</span>&gt;</span>hdfs://foo:8020/app/dataset-definitions/globallogs.xml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dataset</span> <span class="attr">name</span>=<span class="string">&quot;logs&quot;</span> <span class="attr">frequency</span>=<span class="string">&quot;$&#123;coord:hours(12)&#125;&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">initial-instance</span>=<span class="string">&quot;2009-02-15T08:15Z&quot;</span> <span class="attr">timezone</span>=<span class="string">&quot;Americas/Los_Angeles&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">uri-template</span>&gt;</span></span><br><span class="line">    hdfs://foo:8020/app/logs/$&#123;market&#125;/$&#123;YEAR&#125;$&#123;MONTH&#125;/$&#123;DAY&#125;/$&#123;HOUR&#125;/$&#123;MINUTE&#125;/data</span><br><span class="line">    <span class="tag">&lt;/<span class="name">uri-template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">done-flag</span>&gt;</span><span class="tag">&lt;/<span class="name">done-flag</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dataset</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">dataset</span> <span class="attr">name</span>=<span class="string">&quot;stats&quot;</span> <span class="attr">frequency</span>=<span class="string">&quot;$&#123;coord:months(1)&#125;&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">initial-instance</span>=<span class="string">&quot;2009-01-10T10:00Z&quot;</span> <span class="attr">timezone</span>=<span class="string">&quot;Americas/Los_Angeles&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">uri-template</span>&gt;</span>hdfs://foo:8020/usr/app/stats/$&#123;YEAR&#125;/$&#123;MONTH&#125;/data<span class="tag">&lt;/<span class="name">uri-template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">done-flag</span>&gt;</span>over<span class="tag">&lt;/<span class="name">done-flag</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dataset</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">datasets</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>input-events<br>coordinator每次执行时的输入文件，可以是指定的一个文件或者多个时间点生成的多个文件<br>一个Coordinator应用的输入事件指定了要执行一个Coordinator动作必须满足的输入条件，只有当input-events对应的所有文件夹都已创建或者生成了done-flag文件，工作流才会进入running状态<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input-events</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">data-in</span> <span class="attr">name</span>=<span class="string">&quot;BB_INPUT_PREFIX&quot;</span> <span class="attr">dataset</span>=<span class="string">&quot;BbInputPrefix&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">start-instance</span>&gt;</span>$&#123;coord:current(0)&#125;<span class="tag">&lt;/<span class="name">start-instance</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">end-instance</span>&gt;</span>$&#123;coord:current(5)&#125;<span class="tag">&lt;/<span class="name">end-instance</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">data-in</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">data-in</span> <span class="attr">name</span>=<span class="string">&quot;IDC_INPUT_PREFIX&quot;</span> <span class="attr">dataset</span>=<span class="string">&quot;IdcInputPrefix&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">instance</span>&gt;</span>$&#123;coord:current(5)&#125;<span class="tag">&lt;/<span class="name">instance</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">data-in</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">input-events</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>output-events<br>一个Coordinator动作可能会生成一个或多个dataset实例，这些实例由output-events定义<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">output-events</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">data-out</span> <span class="attr">name</span>=<span class="string">&quot;BB_OUTPUT_PREFIX&quot;</span> <span class="attr">dataset</span>=<span class="string">&quot;BbOutputPrefix&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">instance</span>&gt;</span>$&#123;coord:current(5)&#125;<span class="tag">&lt;/<span class="name">instance</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">data-out</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">data-out</span> <span class="attr">name</span>=<span class="string">&quot;IDC_OUTPUT_PREFIX&quot;</span> <span class="attr">dataset</span>=<span class="string">&quot;IdcOutputPrefix&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">instance</span>&gt;</span>$&#123;coord:current(5)&#125;<span class="tag">&lt;/<span class="name">instance</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">data-out</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">output-events</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>action<br>定义coordinator需要触发的workflow，其中定义的property可以在workflow中使用，因为是定时任务，所以输入输出目录就是从这里动态生成的<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">action</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">workflow</span>&gt;</span></span><br><span class="line">	  <span class="tag">&lt;<span class="name">app-path</span>&gt;</span>$&#123;wf_app_path&#125;<span class="tag">&lt;/<span class="name">app-path</span>&gt;</span></span><br><span class="line">	  <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">	    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">	      <span class="tag">&lt;<span class="name">name</span>&gt;</span>dayTime<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">	      <span class="tag">&lt;<span class="name">value</span>&gt;</span>$&#123;coord:formatTime(coord:dateOffset(coord:nominalTime(), -1, &#x27;DAY&#x27;), &#x27;yyyy-MM-dd&#x27;)&#125;<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	  <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">workflow</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br></pre></td></tr></table></figure>
有几个常见的函数需要掌握：<br>${coord:dataIn(String name)}：获取input-events下指定的dataIn对应的所有路径，dataOut作用相同<br>${coord:formatTime(String timeStamp, String format)}：格式化日期，format参数对应的模板是<code>yyyyMMddHHmmss</code>，详细的参考<a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/6/docs/api/java/text/SimpleDateFormat.html">官网</a><br>${coord:dateOffset(String baseDate, int instance, String timeUnit)}：偏移指定的时间间隔，baseDate需传入带时区标准的日期时间格式，timeUnit的参数可以是DAY、HOUR、MINUTE<br>${coord:nominalTime()}：Coordinator的开始时间加上整数倍的频率得到的时间，也就是应该运行当前工作流的时间，可以作为formatTime和dateOffset的输入参数<br>${coord:current(int n)}：返回日期时间：从一个Coordinator动作（Action）创建时开始计算，第n个dataset实例执行时间</li>
</ol>
<h2 id="Extra"><a href="#Extra" class="headerlink" title="Extra"></a>Extra</h2><h3 id="Expression-Language-Functions"><a href="#Expression-Language-Functions" class="headerlink" title="Expression Language Functions"></a>Expression Language Functions</h3><p>Oozie除了允许使用工作流作业属性来参数化工作流作业外，还提供了一组EL函数，这些函数支持对工作流动作节点和决策节点中的谓词进行更复杂的参数化，还有很多跟hadoop相关的常量和函数查看<a target="_blank" rel="noopener" href="https://oozie.apache.org/docs/4.1.0/WorkflowFunctionalSpec.html#a4.2.4_Hadoop_EL_Constants">官网</a></p>
<ol>
<li>Basic EL Constants<br>oozie定义了一些常量，可以直接拿来用<ul>
<li>KB: 1024, one kilobyte.</li>
<li>MB: 1024 * KB, one megabyte.</li>
<li>GB: 1024 * MB, one gigabyte.</li>
<li>TB: 1024 * GB, one terabyte.</li>
<li>PB: 1024 * TG, one petabyte.</li>
</ul>
</li>
<li>Workflow EL Functions<br>这部分直接可以在workflow配置文件中使用${wf:id()}调用，下面列出了常见的操作，更多属性查看<a target="_blank" rel="noopener" href="https://oozie.apache.org/docs/4.1.0/WorkflowFunctionalSpec.html#a4.2.3_Workflow_EL_Functions">官网</a><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">String wf:id()  # 返回当前工作流的ID</span><br><span class="line">String wf:name()  # 返回当前工作流的名称</span><br><span class="line">String wf:appPath()  # 返回当前工作流的路径</span><br><span class="line">String wf:conf(String name)  # 返回当前工作流配置属性的值，如果未定义则返回空字符串</span><br><span class="line">String wf:user()  # 返回启动当前工作流的用户名</span><br><span class="line">String wf:group()  # 返回当前工作流的组/ACL</span><br><span class="line">String wf:callback(String stateVar)  # 返回当前工作流操作节点的回调URL, stateVar可以是该操作的退出状态(=OK=或ERROR)，也可以是执行任务的远程系统用退出状态替换的令牌</span><br><span class="line">String wf:errorMessage(String message)  # 返回指定操作节点的错误消息，如果没有处于error状态的操作节点退出，则返回一个空字符串</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="Workflow-Lifecycle"><a href="#Workflow-Lifecycle" class="headerlink" title="Workflow Lifecycle"></a>Workflow Lifecycle</h3><p>oozie针对工作流定义了不同的状态，它在运行过程中可以处于任何状态<br>    - PREP:当工作流作业第一次创建时，它将处于PREP状态，定义了工作流但还没有运行<br>    - RUNNING:当创建的工作流启动时，它会进入RUNNING状态，当它没有达到结束状态时就会一直保持在RUNNING状态，直到错误或它被挂起<br>    - SUSPENDED:正在运行的工作流可以挂起，它将一直处于SUSPENDED状态，直到该工作流作业恢复或被终止<br>    - SUCCEEDED:当一个正在运行的工作流任务到达结束节点时，最终状态为SUCCEEDED<br>    - KILLED:当管理员或所有者通过对Oozie的请求杀死一个已创建的、正在运行的或挂起的工作流作业时，工作流将进入KILLED状态<br>    - FAILED:当一个正在运行的工作流作业由于意外错误而失败时，它将以FAILED状态结束</p>
<h3 id="失败重试"><a href="#失败重试" class="headerlink" title="失败重试"></a>失败重试</h3><p>工作流失败后oozie可以提供失败重试机制，需要指定重试间隔和重试次数，注意开启失败重试必须做好之前失败工作流的数据清理工作<br>    1. 第一步需要修改一个配置文件，默认oozie只会在几个指定的错误发生时失败重试，需要将它修改为只要发生错误就进行失败重试：<code>oozie.service.LiteWorkflowStoreService.user.retry.error.code.ext=ALL</code><br>    2. 第二步是在workflow配置文件中指定重试间隔和重试次数</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">workflow-app</span> <span class="attr">name</span>=<span class="string">&quot;etl_ds_hive2_action-$&#123;etl_name&#125;&quot;</span> <span class="attr">xmlns</span>=<span class="string">&quot;uri:oozie:workflow:0.5&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">start</span> <span class="attr">to</span>=<span class="string">&quot;hive2_action&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">&quot;hive2_action&quot;</span> <span class="attr">cred</span>=<span class="string">&quot;hive2&quot;</span> <span class="attr">retry-max</span>=<span class="string">&quot;3&quot;</span> <span class="attr">retry-interval</span>=<span class="string">&quot;2&quot;</span> &gt;</span>  <span class="comment">&lt;!--指定失败重试次数和失败间隔，单位是分钟--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ssh</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">host</span>&gt;</span>localhost:22<span class="tag">&lt;<span class="name">host</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">command</span>&gt;</span>chmod<span class="tag">&lt;/<span class="name">command</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">args</span>&gt;</span>-R<span class="tag">&lt;/<span class="name">args</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">args</span>&gt;</span>777<span class="tag">&lt;/<span class="name">args</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">args</span>&gt;</span>/home/root/*<span class="tag">&lt;/<span class="name">args</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ssh</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ok</span> <span class="attr">to</span>=<span class="string">&quot;end&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">error</span> <span class="attr">to</span>=<span class="string">&quot;Kill&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">kill</span> <span class="attr">name</span>=<span class="string">&quot;Kill&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">message</span>&gt;</span>Action failed, error message[$&#123;wf:errorMessage(wf:lastErrorNode())&#125;]<span class="tag">&lt;/<span class="name">message</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">kill</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">end</span> <span class="attr">name</span>=<span class="string">&quot;end&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">workflow-app</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="配置可以解析UTC-8时区"><a href="#配置可以解析UTC-8时区" class="headerlink" title="配置可以解析UTC+8时区"></a>配置可以解析UTC+8时区</h3><p> 新安装的oozie默认只可以解析UTC格式的时间，配置后指定开始和结束时间时就可以使用东八区时间了。CDH配置高级中“oozie-site.xml 的 Oozie Server 高级配置代码段（安全阀）”这个选项内添加下面的代码后重启<br> <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>oozie.processing.timezone<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>GMT+0800<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><p>一个小例子，每五分钟执行一次，检测输入路径内的最近三个事件（按dataset的frequency往前数三个事件，如果对应的文件夹存在则满足条件，否则一直等待），满足条件后在指定的输出路径新建文件夹，注意使用fs action时的权限<br>coordinator.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">coordinator-app</span> <span class="attr">name</span>=<span class="string">&quot;coord-test&quot;</span> <span class="attr">frequency</span>=<span class="string">&quot;$&#123;coord:minutes(5)&#125;&quot;</span></span></span><br><span class="line"><span class="tag">     <span class="attr">start</span>=<span class="string">&quot;$&#123;start_time&#125;&quot;</span> <span class="attr">end</span>=<span class="string">&quot;$&#123;end_time&#125;&quot;</span> <span class="attr">timezone</span>=<span class="string">&quot;GMT+08:00&quot;</span></span></span><br><span class="line"><span class="tag">     <span class="attr">xmlns</span>=<span class="string">&quot;uri:oozie:coordinator:0.1&quot;</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">datasets</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">dataset</span> <span class="attr">name</span>=<span class="string">&quot;logs-1&quot;</span> <span class="attr">frequency</span>=<span class="string">&quot;$&#123;coord:minutes(1)&#125;&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">initial-instance</span>=<span class="string">&quot;$&#123;log_start_time&#125;&quot;</span> <span class="attr">timezone</span>=<span class="string">&quot;GMT+08:00&quot;</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">uri-template</span>&gt;</span>$&#123;input_prefix&#125;/$&#123;HOUR&#125;$&#123;MINUTE&#125;<span class="tag">&lt;/<span class="name">uri-template</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">done-flag</span>&gt;</span><span class="tag">&lt;/<span class="name">done-flag</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">dataset</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">dataset</span> <span class="attr">name</span>=<span class="string">&quot;logs-2&quot;</span> <span class="attr">frequency</span>=<span class="string">&quot;$&#123;coord:minutes(5)&#125;&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">initial-instance</span>=<span class="string">&quot;$&#123;log_start_time&#125;&quot;</span> <span class="attr">timezone</span>=<span class="string">&quot;GMT+08:00&quot;</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">uri-template</span>&gt;</span>$&#123;output_prefix&#125;/$&#123;HOUR&#125;$&#123;MINUTE&#125;<span class="tag">&lt;/<span class="name">uri-template</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">done-flag</span>&gt;</span><span class="tag">&lt;/<span class="name">done-flag</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">dataset</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">datasets</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">input-events</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">data-in</span> <span class="attr">name</span>=<span class="string">&quot;input&quot;</span> <span class="attr">dataset</span>=<span class="string">&quot;logs-1&quot;</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">start-instance</span>&gt;</span>$&#123;coord:current(-3)&#125;<span class="tag">&lt;/<span class="name">start-instance</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">end-instance</span>&gt;</span>$&#123;coord:current(0)&#125;<span class="tag">&lt;/<span class="name">end-instance</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">data-in</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">input-events</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">output-events</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">data-out</span> <span class="attr">name</span>=<span class="string">&quot;output&quot;</span> <span class="attr">dataset</span>=<span class="string">&quot;logs-2&quot;</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">instance</span>&gt;</span>$&#123;coord:current(0)&#125;<span class="tag">&lt;/<span class="name">instance</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">data-out</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">output-events</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">action</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">workflow</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">app-path</span>&gt;</span>$&#123;wf_application_path&#125;<span class="tag">&lt;/<span class="name">app-path</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">                         <span class="tag">&lt;<span class="name">name</span>&gt;</span>HDFS_INPUT<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">                         <span class="tag">&lt;<span class="name">value</span>&gt;</span>$&#123;coord:dataIn(&#x27;input&#x27;)&#125;<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">                         <span class="tag">&lt;<span class="name">name</span>&gt;</span>HDFS_OUTPUT<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">                         <span class="tag">&lt;<span class="name">value</span>&gt;</span>$&#123;coord:dataOut(&#x27;output&#x27;)&#125;<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">workflow</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">coordinator-app</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>workflow.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">workflow-app</span> <span class="attr">name</span>=<span class="string">&quot;sample-wf&quot;</span> <span class="attr">xmlns</span>=<span class="string">&quot;uri:oozie:workflow:0.1&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">start</span> <span class="attr">to</span>=<span class="string">&quot;myssjob&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">&quot;myssjob&quot;</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">fs</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 注意执行权限 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">mkdir</span> <span class="attr">path</span>=<span class="string">&#x27;$&#123;HDFS_OUTPUT&#125;/result&#x27;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">fs</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ok</span> <span class="attr">to</span>=<span class="string">&quot;end&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">error</span> <span class="attr">to</span>=<span class="string">&quot;kill&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">kill</span> <span class="attr">name</span>=<span class="string">&quot;kill&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">message</span>&gt;</span>Action failed, error message[$&#123;wf:errorMessage(wf:lastErrorNode())&#125;]<span class="tag">&lt;/<span class="name">message</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">kill</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">end</span> <span class="attr">name</span>=<span class="string">&quot;end&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">workflow-app</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>start.sh</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">start_time=2022-07-21T13:30+0800</span><br><span class="line">end_time=2022-07-21T13:40+0800</span><br><span class="line">log_start_time=2022-07-21T13:20+0800</span><br><span class="line">workflow_user=hdfs</span><br><span class="line">input_prefix=/user/wxk/oozie/hdfs/input</span><br><span class="line">output_prefix=/user/wxk/oozie/hdfs/output</span><br><span class="line">name_node=hdfs://namenode.haohan.com:8020</span><br><span class="line">wf_application_path=hdfs://namenode.haohan.com:8020/user/wxk/oozie/hdfs/config</span><br><span class="line"></span><br><span class="line">oozie job -oozie http://localhost:11000/oozie -run \</span><br><span class="line">    -D oozie.wf.validate.ForkJoin=<span class="literal">false</span> \</span><br><span class="line">    -D oozie.use.system.libpath=<span class="literal">true</span> \</span><br><span class="line">    -D oozie.coord.application.path=<span class="variable">$&#123;wf_application_path&#125;</span> \  <span class="comment"># 告知oozie配置所在位置，如果非定时任务则使用oozie.wf.application.path</span></span><br><span class="line">    -D useStrictFilterStrategy=<span class="literal">true</span> \</span><br><span class="line">    -D user.name=<span class="variable">$&#123;workflow_user&#125;</span> \</span><br><span class="line">    -D mapreduce.job.user.name=<span class="variable">$&#123;workflow_user&#125;</span> \</span><br><span class="line">    -D wf_application_path=<span class="variable">$&#123;wf_application_path&#125;</span> \</span><br><span class="line">    -D start_time=<span class="variable">$&#123;start_time&#125;</span> \</span><br><span class="line">    -D end_time=<span class="variable">$&#123;end_time&#125;</span> \</span><br><span class="line">    -D log_start_time=<span class="variable">$&#123;log_start_time&#125;</span> \</span><br><span class="line">    -D input_prefix=<span class="variable">$&#123;input_prefix&#125;</span> \</span><br><span class="line">    -D output_prefix=<span class="variable">$&#123;output_prefix&#125;</span> \</span><br><span class="line">    -D name_node=<span class="variable">$&#123;name_node&#125;</span></span><br></pre></td></tr></table></figure></div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">WangXun</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://wangxukun.top/2022/04/20/Software/Oozie-入门基础/">https://wangxukun.top/2022/04/20/Software/Oozie-入门基础/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Oozie/">Oozie</a></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2022/08/11/Software/Spark%E8%BF%9B%E9%98%B6-SparkContext%E4%B9%8BSparnEnv/"><i class="fa fa-chevron-left">  </i><span>Spark进阶-SparkContext之SparnEnv</span></a></div><div class="next-post pull-right"><a href="/2022/02/27/Software/HBase-05%E5%8D%8F%E5%A4%84%E7%90%86%E5%99%A8%E5%92%8C%E8%BF%87%E6%BB%A4%E5%99%A8/"><span>HBase-05协处理器和过滤器</span><i class="fa fa-chevron-right"></i></a></div></nav><div id="gitalk-container"></div><script>var gitalk = new Gitalk({
  clientID: 'aaf2844e0aeef4917c17',
  clientSecret: '10b96d24dffda7d3b4544778cf620f81990b676d',
  repo: 'blog-issue',
  owner: 'w749',
  admin: 'w749',
  id: md5(decodeURI(location.pathname)),
  language: 'en'
})
gitalk.render('gitalk-container')</script></div></div><footer class="footer-bg" style="background-image: url(/img/top-img.jpg)"><div class="layout" id="footer"><div class="copyright">&copy;2019 - 2022 By WangXun</div><div class="framework-info"><span>Driven - </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="footer_custom_text">hitokoto</div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-eye"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/lib/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.9.1"></script><script src="/js/fancybox.js?version=1.9.1"></script><script src="/js/sidebar.js?version=1.9.1"></script><script src="/js/copy.js?version=1.9.1"></script><script src="/js/fireworks.js?version=1.9.1"></script><script src="/js/transition.js?version=1.9.1"></script><script src="/js/scroll.js?version=1.9.1"></script><script src="/js/head.js?version=1.9.1"></script><script src="/js/search/algolia.js"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script><div class="search-dialog" id="algolia-search"><div class="search-dialog__title" id="algolia-search-title">Algolia</div><div id="algolia-input-panel"><div id="algolia-search-input"></div></div><hr><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-stats"></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>