<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="R语言常用包"><meta name="keywords" content="R"><meta name="author" content="WangXun"><meta name="copyright" content="WangXun"><title>R语言常用包 | Wake</title><link rel="shortcut icon" href="/img/favicon-blank.svg"><link rel="stylesheet" href="/css/index.css?version=1.9.1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.1"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.css"><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.js" defer></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js"></script><script src="https://cdn.jsdelivr.net/npm/blueimp-md5@2.10.0/js/md5.min.js"></script><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://v1.hitokoto.cn/?encode=js&amp;charset=utf-8&amp;select=.footer_custom_text" defer></script><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: {"appId":"HSM2EINL2X","apiKey":"6f1478b12150efd917d5ecfcddfb8b8b","indexName":"wangxun","hits":{"per_page":10},"languages":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}.","hits_stats":"${hits} results found in ${time} ms"}},
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  hexoVersion: '6.0.0'
} </script><meta name="generator" content="Hexo 6.0.0"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BA%95%E5%B1%82%E5%9F%BA%E7%A1%80"><span class="toc-number">1.</span> <span class="toc-text">底层基础</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E7%9A%84%E5%87%A0%E4%B8%AA%E7%8E%AF%E5%A2%83%E4%BB%A5%E5%8F%8A%E5%8F%82%E6%95%B0%E5%AF%BB%E5%9D%80"><span class="toc-number">1.1.</span> <span class="toc-text">函数的几个环境以及参数寻址</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E7%9A%84%E5%9B%9B%E4%B8%AA%E7%8E%AF%E5%A2%83"><span class="toc-number">1.1.1.</span> <span class="toc-text">函数的四个环境</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E5%AF%BB%E5%9D%80%E9%97%AE%E9%A2%98"><span class="toc-number">1.1.2.</span> <span class="toc-text">参数寻址问题</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E5%AF%BB%E5%9D%80%E8%A1%A5%E5%85%85"><span class="toc-number">1.1.3.</span> <span class="toc-text">参数寻址补充</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#R%E8%AF%AD%E8%A8%80%E4%B8%AD%E7%9A%84%E5%A4%8D%E5%88%B6"><span class="toc-number">1.2.</span> <span class="toc-text">R语言中的复制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RFC4180-csv%E6%96%87%E4%BB%B6%E5%AD%98%E5%82%A8%E5%8D%8F%E8%AE%AE"><span class="toc-number">1.3.</span> <span class="toc-text">RFC4180 csv文件存储协议</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8A%80%E6%9C%AF%E9%97%AE%E9%A2%98"><span class="toc-number">2.</span> <span class="toc-text">技术问题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%BC%E5%85%A5%E5%8C%85"><span class="toc-number">2.1.</span> <span class="toc-text">导入包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#grep%E5%92%8Cgrepl%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">2.2.</span> <span class="toc-text">grep和grepl的区别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#gsub%E3%80%81replace%E6%9B%BF%E6%8D%A2%E6%93%8D%E4%BD%9C"><span class="toc-number">2.3.</span> <span class="toc-text">gsub、replace替换操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%8C%E8%BD%AC%E5%88%97spread%E5%92%8C%E5%88%97%E8%BD%AC%E8%A1%8Cgather"><span class="toc-number">2.4.</span> <span class="toc-text">行转列spread和列转行gather</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E7%A9%BA%E9%97%B4%E6%93%8D%E4%BD%9C"><span class="toc-number">2.5.</span> <span class="toc-text">环境空间操作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E7%A9%BA%E9%97%B4%E4%B8%AD%E7%9A%84%E5%8F%98%E9%87%8F"><span class="toc-number">2.5.1.</span> <span class="toc-text">环境空间中的变量</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AE%A1%E7%90%86%E5%B7%A5%E4%BD%9C%E7%A9%BA%E9%97%B4"><span class="toc-number">2.5.2.</span> <span class="toc-text">管理工作空间</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86%E5%A4%9A%E4%B8%AAdf%E5%86%99%E5%85%A5excel%E7%9A%84%E4%B8%8D%E5%90%8C%E4%BD%8D%E7%BD%AE"><span class="toc-number">2.6.</span> <span class="toc-text">将多个df写入excel的不同位置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#apply%E5%AE%B6%E6%97%8F"><span class="toc-number">2.7.</span> <span class="toc-text">apply家族</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#apply%E5%87%BD%E6%95%B0"><span class="toc-number">2.7.1.</span> <span class="toc-text">apply函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#lapply%E5%87%BD%E6%95%B0"><span class="toc-number">2.7.2.</span> <span class="toc-text">lapply函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#sapply%E5%87%BD%E6%95%B0"><span class="toc-number">2.7.3.</span> <span class="toc-text">sapply函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#vapply%E5%87%BD%E6%95%B0"><span class="toc-number">2.7.4.</span> <span class="toc-text">vapply函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#mapply%E5%87%BD%E6%95%B0"><span class="toc-number">2.7.5.</span> <span class="toc-text">mapply函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#tapply%E5%87%BD%E6%95%B0"><span class="toc-number">2.7.6.</span> <span class="toc-text">tapply函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#rapply%E5%87%BD%E6%95%B0"><span class="toc-number">2.7.7.</span> <span class="toc-text">rapply函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#eapply%E5%87%BD%E6%95%B0"><span class="toc-number">2.7.8.</span> <span class="toc-text">eapply函数</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#split%E5%92%8Cunsplit"><span class="toc-number">2.8.</span> <span class="toc-text">split和unsplit</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#R%E4%B8%AD%E7%9A%84%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-number">2.9.</span> <span class="toc-text">R中的表达式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#expression%E5%92%8Cquote%E5%87%BD%E6%95%B0"><span class="toc-number">2.9.1.</span> <span class="toc-text">expression和quote函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#bquote%E5%92%8Csubstitute%E5%87%BD%E6%95%B0"><span class="toc-number">2.9.2.</span> <span class="toc-text">bquote和substitute函数</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#df%E5%88%A0%E9%99%A4%E9%87%8D%E5%A4%8D%E8%A1%8C"><span class="toc-number">2.10.</span> <span class="toc-text">df删除重复行</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#partial%E4%BC%A0%E5%8F%82%E5%92%8Ccompose%E7%BB%84%E5%90%88%E5%87%BD%E6%95%B0"><span class="toc-number">2.11.</span> <span class="toc-text">partial传参和compose组合函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E3%80%81-%E5%92%8C-%E5%85%AC%E5%BC%8F"><span class="toc-number">2.12.</span> <span class="toc-text">!!、!!!和~公式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#expr%E7%B3%BB%E5%88%97%E3%80%81sym%E7%B3%BB%E5%88%97%E5%92%8Cquo%E7%B3%BB%E5%88%97"><span class="toc-number">2.13.</span> <span class="toc-text">expr系列、sym系列和quo系列</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#map%E3%80%81reduce%E5%92%8Cmap-df"><span class="toc-number">2.14.</span> <span class="toc-text">map、reduce和map_df</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ES%E6%9F%A5%E8%AF%A2%E7%9B%B8%E5%85%B3"><span class="toc-number">2.15.</span> <span class="toc-text">ES查询相关</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BB%BA%E7%AB%8B%E8%BF%9E%E6%8E%A5%E5%92%8C%E6%95%B0%E6%8D%AE%E8%BD%AC%E6%8D%A2"><span class="toc-number">2.15.1.</span> <span class="toc-text">建立连接和数据转换</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E8%AF%AD%E5%8F%A5body%E7%9A%84%E7%BC%96%E5%86%99"><span class="toc-number">2.15.2.</span> <span class="toc-text">查询语句body的编写</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E8%AF%AD%E5%8F%A5%E7%9A%84%E4%BC%A0%E5%85%A5"><span class="toc-number">2.15.3.</span> <span class="toc-text">查询语句的传入</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%91%E9%80%81%E9%82%AE%E4%BB%B6"><span class="toc-number">2.16.</span> <span class="toc-text">发送邮件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#R%E8%84%9A%E6%9C%AC%E8%BF%90%E8%A1%8C%E8%87%AA%E6%A3%80%E6%B5%8B"><span class="toc-number">2.17.</span> <span class="toc-text">R脚本运行自检测</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%93%E5%8C%85%E6%95%B0%E6%8D%AE"><span class="toc-number">2.18.</span> <span class="toc-text">打包数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E6%9E%90json%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-number">2.19.</span> <span class="toc-text">解析json字符串</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#S3%E7%B1%BB-amp-%E6%B3%9B%E5%9E%8B%E5%87%BD%E6%95%B0"><span class="toc-number">2.20.</span> <span class="toc-text">S3类&amp;泛型函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#stringr%E5%8C%85"><span class="toc-number">2.21.</span> <span class="toc-text">stringr包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#openxlsx%E5%8C%85"><span class="toc-number">2.22.</span> <span class="toc-text">openxlsx包</span></a></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/img/avatar.jpg"></div><div class="author-info__name text-center">WangXun</div><div class="author-info__description text-center"></div><div class="follow-button"><a target="_blank" rel="noopener" href="https://github.com/w749">Follow Me</a></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">71</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">20</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">Categories</span><span class="pull-right">6</span></a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(/img/top-img.jpg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Wake</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span><span class="pull-right"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> Search</span></a></span></div><div id="post-info"><div id="post-title">R语言常用包</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-08-22</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/Language/">Language</a><div class="post-meta-wordcount"><span>Word count: </span><span class="word-count">11.1k</span><span class="post-meta__separator">|</span><span>Reading time: 45 min</span></div></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><p>R语言基础知识以及常用包操作。</p>
<span id="more"></span>

<h2 id="底层基础"><a href="#底层基础" class="headerlink" title="底层基础"></a>底层基础</h2><h3 id="函数的几个环境以及参数寻址"><a href="#函数的几个环境以及参数寻址" class="headerlink" title="函数的几个环境以及参数寻址"></a>函数的几个环境以及参数寻址</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">f <span class="operator">&lt;-</span> <span class="keyword">function</span><span class="punctuation">(</span>x<span class="punctuation">,</span> label<span class="operator">=</span>deparse<span class="punctuation">(</span>x<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line">              label</span><br><span class="line">              x <span class="operator">&lt;-</span> x<span class="operator">+</span><span class="number">1</span></span><br><span class="line">              print<span class="punctuation">(</span><span class="string">&#x27;这是f函数：&#x27;</span><span class="punctuation">,</span> <span class="built_in">quote</span> <span class="operator">=</span> <span class="built_in">F</span><span class="punctuation">)</span></span><br><span class="line">              print<span class="punctuation">(</span>label<span class="punctuation">)</span></span><br><span class="line">              print<span class="punctuation">(</span>x<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line">f1 <span class="operator">&lt;-</span> <span class="keyword">function</span><span class="punctuation">(</span>x<span class="punctuation">,</span> label<span class="operator">=</span>deparse<span class="punctuation">(</span>x<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line">              x <span class="operator">&lt;-</span> x<span class="operator">+</span><span class="number">1</span></span><br><span class="line">              print<span class="punctuation">(</span><span class="string">&#x27;这是f1函数：&#x27;</span><span class="punctuation">,</span> <span class="built_in">quote</span> <span class="operator">=</span> <span class="built_in">F</span><span class="punctuation">)</span></span><br><span class="line">              print<span class="punctuation">(</span>label<span class="punctuation">)</span></span><br><span class="line">              print<span class="punctuation">(</span>x<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line">f<span class="punctuation">(</span><span class="number">1</span><span class="punctuation">)</span>; f1<span class="punctuation">(</span><span class="number">1</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>

<h4 id="函数的四个环境"><a href="#函数的四个环境" class="headerlink" title="函数的四个环境"></a>函数的四个环境</h4><ul>
<li>第一个环境是<strong>全局环境</strong>~当前环境；</li>
<li>第二个环境是函数<strong>被定义的环境</strong>，在这里就是当前环境；</li>
<li>第三个环境是function的<strong>参数环境</strong>，是一个局部环境参数等号左边是局部变量，等号右边是全局变量、缺省值或者传入的参数；</li>
<li>第四个环境是函数在被调用的时候函数体内部运行时内存给分配的<strong>临时环境（堆栈）</strong>，函数运行完成后会被销毁。</li>
</ul>
<h4 id="参数寻址问题"><a href="#参数寻址问题" class="headerlink" title="参数寻址问题"></a>参数寻址问题</h4><p>关于上方两个函数f和f1，结果不同是因为函数体在运行时参数的寻址环境顺序不同导致的，f函数先运行label，函数体未定义label，它就会去参数环境中寻找，发现它等于deparse(x），然后这个x就是参数环境中的另外一个参数，这个参数在调用f的时候被赋值为1（f(1)），所以label就等于“1”，接下来运行第二步x自增1后等于2，第三步第四步print变量时会优先寻址当前运行的环境，label对应“1”，x对应2；关于f1函数，不同的地方是label变量是在x自增之后才被执行的，deparse(x）会优先寻址当前运行环境，结果就是“2”。</p>
<h4 id="参数寻址补充"><a href="#参数寻址补充" class="headerlink" title="参数寻址补充"></a>参数寻址补充</h4><p>函数中的参数是<strong>惰性求值</strong>，不执行则不运算，只有在执行或者被调用的时候才会进行运算；函数体执行运算用到变量时若函数体中未定义，参数环境中也未定义，则会向全局环境中寻址；函数在被调用时若有缺省值，则局部参数被调用时会优先使用传入的参数，若未传入参数才会使用缺省值。</p>
<h3 id="R语言中的复制"><a href="#R语言中的复制" class="headerlink" title="R语言中的复制"></a>R语言中的复制</h3><p>分两个部分来讲，<strong>变量的复制和环境的复制</strong>。</p>
<p>首先是<strong>变量的复制</strong>，定义一个变量a指向数据c(1,2,3)，再定义一个变量b指向变量a（实际上是指向变量a指向的数据），这个时候两个变量指向内存中的数据地址是一样的（可以用浅复制来理解，但不建议），接着修改变量a指向的数据，此时再看b并没有发生变化，此时再比较两者会发现指向的数据地址已经不一样了，使用base包中的tracemem函数可以追踪两个变量的地址变化，其实是因为修改a变量时会在内存中把a指向的数据复制一份，随后再对复制的这份数据进行修改（可以理解为先浅复制指向同一内存，赋值时会发生深复制指向不同的内存地址，但不建议）。</p>
<p>其次是<strong>环境的复制</strong>，新建变量a指向一个新环境，随后新建变量b指向a，此时a和b就是环境的内存地址，这里和变量不一样，接着在a环境中定义变量aa，查看b环境时会发现也有aa变量（可以理解为浅复制，不建议）。</p>
<p>这就是R语言中的复制，<strong>不存在深复制和浅复制</strong>这一说，可以用深复制和浅复制的概念来辅助理解，但不要死搬硬套，不然在变量复制的理解上就会产生矛盾。</p>
<h3 id="RFC4180-csv文件存储协议"><a href="#RFC4180-csv文件存储协议" class="headerlink" title="RFC4180 csv文件存储协议"></a>RFC4180 csv文件存储协议</h3><p><strong>CSV用逗号分隔字段</strong>的基本思想是清楚的，但是当字段数据也可能<strong>包含逗号或者甚至嵌入换行符</strong>时，该想法变得复杂。 CSV实现可能无法处理这些字段数据，或者可能会使用引号来包围字段。<strong>引用并不能解决所有问题</strong>：有些字段可能需要嵌入引号，因此CSV实现可能<strong>包含转义字符或转义序列</strong>。</p>
<p><a target="_blank" rel="noopener" href="https://www.rfc-editor.org/rfc/inline-errata/rfc4180.html"><strong>RFC 4180</strong></a>提出了MIME类型（”text&#x2F;csv”）对于CSV格式的标准，可以作为一般使用的常用定义，满足大多数实现似乎遵循的格式。</p>
<ol>
<li>每一行记录位于一个单独的行上，用回车换行符CRLF(也就是\r\n)分割。</li>
</ol>
<p>Each record is located on a separate line, delimited by a line break (CRLF). For example:<br>aaa,bbb,ccc CRLF<br>zzz,yyy,xxx CRLF</p>
<ol start="2">
<li>文件中的最后一行记录可以有结尾回车换行符，也可以没有。</li>
</ol>
<p>The last record in the file may or may not have an ending line break. For example:<br>aaa,bbb,ccc CRLF<br>zzz,yyy,xxx</p>
<ol start="3">
<li>第一行可以存在一个可选的标题头，格式和普通记录行的格式一样。标题头要包含文件记录字段对应的名称，应该有和记录字段一样的数量。（在MIME类型中，标题头行的存在与否可以通过MIME type中的可选”header”参数指明）</li>
</ol>
<p>There maybe an optional header line appearing as the first line of the file with the same format as normal record lines. This header will contain names corresponding to the fields in the file and should contain the same number of fields as the records in the rest of the file (the presence or absence of the header line should be indicated via the optional “header” parameter of this MIME type). For example:<br>field_name,field_name,field_name CRLF<br>aaa,bbb,ccc CRLF<br>zzz,yyy,xxx CRLF</p>
<ol start="4">
<li>在标题头行和普通行每行记录中，会存在一个或多个由半角逗号(,)分隔的字段。整个文件中每行应包含相同数量的字段，空格也是字段的一部分，不应被忽略。每一行记录最后一个字段后不能跟逗号。（通常用逗号分隔，也有其他字符分隔的CSV，需事先约定）</li>
</ol>
<p>Within the header and each record, there may be one or more fields, separated by commas. Each line should contain the same number of fields throughout the file. Spaces are considered part of a field and should not be ignored. The last field in the record must not be followed by a comma. For example:<br>aaa,bbb,ccc</p>
<ol start="5">
<li>每个字段可用也可不用半角双引号(“)括起来（不过有些程序，如Microsoft的Excel就根本不用双引号）。如果字段没有用引号括起来，那么该字段内部不能出现双引号字符。</li>
</ol>
<p>Each field may or may not be enclosed in double quotes (however some programs, such as Microsoft Excel, do not use double quotes at all). If fields are not enclosed with double quotes, then double quotes may not appear inside the fields. For example:<br>“aaa”,”bbb”,”ccc” CRLF<br>zzz,yyy,xxx</p>
<ol start="6">
<li>字段中若包含回车换行符、双引号或者逗号，该字段需要用双引号括起来。</li>
</ol>
<p>Fields containing line breaks (CRLF), double quotes, and commas should be enclosed in double-quotes. For example:<br>“aaa”,”b CRLF<br>bb”,”ccc” CRLF<br>zzz,yyy,xxx</p>
<ol start="7">
<li>如果用双引号括字段，那么出现在字段内的双引号前必须加一个双引号进行转义。</li>
</ol>
<p>If double-quotes are used to enclose fields, then a double-quote appearing inside a field must be escaped by preceding it with another double quote. For example:<br>“aaa”,”b””bb”,”ccc”</p>
<p><strong>补充：R语言</strong>在这里设置的比较好，默认write.csv的时候会有quote参数设置是否需要将元素用双引号括起来，元素中出现的双引号会默认添加”转义，对于换行符这些则需要添加反斜杠进行转义，read.csv读取的时候也会按这个协议进行读取。</p>
<h2 id="技术问题"><a href="#技术问题" class="headerlink" title="技术问题"></a>技术问题</h2><h3 id="导入包"><a href="#导入包" class="headerlink" title="导入包"></a>导入包</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">knitr<span class="operator">::</span>opts_chunk<span class="operator">$</span>set<span class="punctuation">(</span>echo <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>dplyr<span class="punctuation">,</span> warn.conflicts <span class="operator">=</span> <span class="built_in">F</span><span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>tidyr<span class="punctuation">,</span> warn.conflicts <span class="operator">=</span> <span class="built_in">F</span><span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>pryr<span class="punctuation">,</span> warn.conflicts <span class="operator">=</span> <span class="built_in">F</span><span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>purrr<span class="punctuation">,</span> warn.conflicts <span class="operator">=</span> <span class="built_in">F</span><span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>elastic<span class="punctuation">,</span> warn.conflicts <span class="operator">=</span> <span class="built_in">F</span><span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>esHelp<span class="punctuation">)</span></span><br><span class="line">exprs <span class="operator">&lt;-</span> rlang<span class="operator">::</span>exprs</span><br></pre></td></tr></table></figure>

<h3 id="grep和grepl的区别"><a href="#grep和grepl的区别" class="headerlink" title="grep和grepl的区别"></a>grep和grepl的区别</h3><p>grep查询结果为<strong>整个向量</strong>、列表等数据中是否含有并返回一个逻辑值，grepl查询返回结果为<strong>每个元素对应的</strong>T或者F:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">grep<span class="punctuation">(</span><span class="string">&#x27;youzan&#x27;</span><span class="punctuation">,</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;youzanw&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;fsew&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span>  <span class="comment"># 查询youzan在向量中的结果返回单个T</span></span><br><span class="line">grepl<span class="punctuation">(</span><span class="string">&#x27;youzan&#x27;</span><span class="punctuation">,</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;youzanw&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;fsew&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span>  <span class="comment"># 查询结果则返回每个元素对应的T或者F</span></span><br></pre></td></tr></table></figure>

<h3 id="gsub、replace替换操作"><a href="#gsub、replace替换操作" class="headerlink" title="gsub、replace替换操作"></a>gsub、replace替换操作</h3><p>替换每个元素中的字符或数字，替换结果为字符串<strong>使用gsub</strong>，当然，也可以使用正则表达式</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 替换字符串中的字符</span></span><br><span class="line">a <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;i am hungry&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;you are xxx&#x27;</span><span class="punctuation">)</span></span><br><span class="line">gsub<span class="punctuation">(</span><span class="string">&#x27; &#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;-&#x27;</span><span class="punctuation">,</span> a<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 替换数字，返回结果为字符串</span></span><br><span class="line">b <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">3</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">,</span> <span class="number">7</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">)</span></span><br><span class="line">gsub<span class="punctuation">(</span><span class="number">2</span><span class="punctuation">,</span> <span class="number">222</span><span class="punctuation">,</span> b<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>

<p>替换指定位置的元素或者指定条件的元素<strong>使用replace</strong></p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 替换指定位置元素</span></span><br><span class="line">a <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;i am hungry&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;you are xxx&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;abcde&#x27;</span><span class="punctuation">)</span></span><br><span class="line">replace<span class="punctuation">(</span>a<span class="punctuation">,</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="number">222</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 替换指定条件元素</span></span><br><span class="line">b <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">3</span><span class="punctuation">,</span> <span class="operator">-</span><span class="number">5</span><span class="punctuation">,</span> <span class="number">7</span><span class="punctuation">,</span> <span class="operator">-</span><span class="number">9</span><span class="punctuation">)</span></span><br><span class="line">replace<span class="punctuation">(</span>b<span class="punctuation">,</span> b<span class="operator">&lt;</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">222</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 也可以使用ifelse实现</span></span><br><span class="line">ifelse<span class="punctuation">(</span>b<span class="operator">&lt;</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">222</span><span class="punctuation">,</span> b<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>

<h3 id="行转列spread和列转行gather"><a href="#行转列spread和列转行gather" class="headerlink" title="行转列spread和列转行gather"></a>行转列spread和列转行gather</h3><ul>
<li>行转列将某一字段中的值提到col中，并将对应的value值reshape，列转行将col转到单个字段中并将原col对应的值一一映射。</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">stocks <span class="operator">&lt;-</span> tibble<span class="punctuation">(</span>time <span class="operator">=</span> as.Date<span class="punctuation">(</span><span class="string">&#x27;2009-01-01&#x27;</span><span class="punctuation">)</span> <span class="operator">+</span> <span class="number">0</span><span class="operator">:</span><span class="number">9</span><span class="punctuation">,</span></span><br><span class="line">                X <span class="operator">=</span> rnorm<span class="punctuation">(</span><span class="number">10</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                Y <span class="operator">=</span> rnorm<span class="punctuation">(</span><span class="number">10</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                Z <span class="operator">=</span> rnorm<span class="punctuation">(</span><span class="number">10</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">4</span><span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">)</span></span><br><span class="line">stocks  <span class="comment"># 原始数据</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># gather列转行，指定需转为行的列名，再指定key对应colname，value对应value的colname</span></span><br><span class="line">a <span class="operator">&lt;-</span> stocks <span class="operator">%&gt;%</span> gather<span class="punctuation">(</span><span class="string">&#x27;X&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;Y&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;Z&#x27;</span><span class="punctuation">,</span> key<span class="operator">=</span><span class="string">&#x27;stock&#x27;</span><span class="punctuation">,</span> value<span class="operator">=</span><span class="string">&#x27;price&#x27;</span><span class="punctuation">)</span>; a</span><br><span class="line"></span><br><span class="line"><span class="comment"># spread行转列，指定需要转的key对应col，把它转为原始状态</span></span><br><span class="line">a <span class="operator">%&gt;%</span> spread<span class="punctuation">(</span>key<span class="operator">=</span><span class="string">&#x27;stock&#x27;</span><span class="punctuation">,</span> value<span class="operator">=</span><span class="string">&#x27;price&#x27;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>

<h3 id="环境空间操作"><a href="#环境空间操作" class="headerlink" title="环境空间操作"></a>环境空间操作</h3><p>环境空间的<strong>基本操作</strong>以及空间内变量的基本操作</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建一个新环境</span></span><br><span class="line">env1 <span class="operator">&lt;-</span> new.env<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 判断是否是一个环境变量</span></span><br><span class="line"><span class="built_in">is.environment</span><span class="punctuation">(</span>env1<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看当前环境变量</span></span><br><span class="line">environment<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看函数中的环境空间</span></span><br><span class="line">environment<span class="punctuation">(</span>ls<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看环境空间的名字</span></span><br><span class="line">environmentName<span class="punctuation">(</span><span class="built_in">baseenv</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">environmentName<span class="punctuation">(</span>environment<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置环境变量的名字，默认创建出来是没有名字的</span></span><br><span class="line"><span class="built_in">attr</span><span class="punctuation">(</span>env1<span class="punctuation">,</span> <span class="string">&#x27;name&#x27;</span><span class="punctuation">)</span> <span class="operator">&lt;-</span> <span class="string">&#x27;env1&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看环境变量的属性值</span></span><br><span class="line">env.profile<span class="punctuation">(</span>env1<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>

<h4 id="环境空间中的变量"><a href="#环境空间中的变量" class="headerlink" title="环境空间中的变量"></a>环境空间中的变量</h4><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 清空当前环境空间定义的所有对象</span></span><br><span class="line">rm<span class="punctuation">(</span><span class="built_in">list</span><span class="operator">=</span>ls<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义环境空间中的变量</span></span><br><span class="line">x <span class="operator">&lt;-</span> 1.5; y <span class="operator">&lt;-</span> 2<span class="operator">:</span><span class="number">10</span></span><br><span class="line">env1 <span class="operator">&lt;-</span> new.env<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line">env1<span class="operator">$</span>x <span class="operator">&lt;-</span> <span class="operator">-</span><span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看env1环境变量中的变量</span></span><br><span class="line">ls<span class="punctuation">(</span>env1<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 环境空间变量取值</span></span><br><span class="line">get<span class="punctuation">(</span><span class="string">&#x27;x&#x27;</span><span class="punctuation">,</span> envir<span class="operator">=</span>env1<span class="punctuation">)</span>  <span class="comment"># 取env1环境变量中的x值</span></span><br><span class="line">get<span class="punctuation">(</span><span class="string">&#x27;y&#x27;</span><span class="punctuation">,</span> envir<span class="operator">=</span>env1<span class="punctuation">)</span>  <span class="comment"># 从env1环境空间中取从当前环境中继承的y值</span></span><br><span class="line"><span class="comment"># get(&#x27;y&#x27;, envir=env1, inherits=FALSE)  # 禁止环境空间的继承，会报错</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 重新赋值</span></span><br><span class="line">assign<span class="punctuation">(</span><span class="string">&#x27;x&#x27;</span><span class="punctuation">,</span> <span class="number">77</span><span class="punctuation">)</span>; x  <span class="comment"># 重新赋值当前环境变量中的x值</span></span><br><span class="line">assign<span class="punctuation">(</span><span class="string">&#x27;x&#x27;</span><span class="punctuation">,</span> <span class="number">99</span><span class="punctuation">,</span> envir<span class="operator">=</span>env1<span class="punctuation">)</span>; env1<span class="operator">$</span>x  <span class="comment"># 重新赋值环境空间中的x值</span></span><br><span class="line">assign<span class="punctuation">(</span><span class="string">&#x27;y&#x27;</span><span class="punctuation">,</span> <span class="number">333</span><span class="punctuation">,</span> envir<span class="operator">=</span>env1<span class="punctuation">,</span> inherits<span class="operator">=</span><span class="literal">FALSE</span><span class="punctuation">)</span>  <span class="comment"># 在没有继承的情况下给环境空间中的y赋值</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除env1中的变量</span></span><br><span class="line">rm<span class="punctuation">(</span>x<span class="punctuation">,</span> envir<span class="operator">=</span>env1<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 变量在环境变量中是否存在</span></span><br><span class="line">exists<span class="punctuation">(</span><span class="string">&#x27;x&#x27;</span><span class="punctuation">)</span></span><br><span class="line">exists<span class="punctuation">(</span><span class="string">&#x27;x&#x27;</span><span class="punctuation">,</span> envir<span class="operator">=</span>env1<span class="punctuation">)</span></span><br><span class="line"><span class="comment"># exists(&#x27;y&#x27;, envir=env1, isherits=FALSE)  # 在没有继承的情况下y是否存在，会报错</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看函数的环境空间，来自pryr包</span></span><br><span class="line">where<span class="punctuation">(</span><span class="string">&#x27;mean&#x27;</span><span class="punctuation">)</span></span><br><span class="line">where<span class="punctuation">(</span><span class="string">&#x27;where&#x27;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>

<h4 id="管理工作空间"><a href="#管理工作空间" class="headerlink" title="管理工作空间"></a>管理工作空间</h4><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># setwd(&#x27;/Users/mac/python/R&#x27;)  # 修改工作目录为</span></span><br><span class="line">getwd<span class="punctuation">(</span><span class="punctuation">)</span>  <span class="comment"># 显示当前工作目录</span></span><br><span class="line">ls<span class="punctuation">(</span><span class="punctuation">)</span>  <span class="comment"># 列出当前工作空间中的对象</span></span><br><span class="line">search<span class="punctuation">(</span><span class="punctuation">)</span>  <span class="comment"># 查看已载入的包</span></span><br><span class="line">q<span class="punctuation">(</span><span class="punctuation">)</span>  <span class="comment"># 退出R</span></span><br><span class="line">library<span class="punctuation">(</span><span class="punctuation">)</span>  <span class="comment"># 查看已安装的包</span></span><br><span class="line">options<span class="punctuation">(</span><span class="punctuation">)</span>  <span class="comment"># 显示或设置当前选项</span></span><br><span class="line">history<span class="punctuation">(</span><span class="punctuation">)</span>  <span class="comment"># 显示最近使用过的指令数量，默认25个</span></span><br><span class="line">savehistory<span class="punctuation">(</span><span class="string">&#x27;myfile&#x27;</span><span class="punctuation">)</span>  <span class="comment"># 保存命令历史到myfile文件中</span></span><br><span class="line">loadhistory<span class="punctuation">(</span><span class="string">&#x27;myfile&#x27;</span><span class="punctuation">)</span>  <span class="comment"># 载入一个命令历史文件</span></span><br><span class="line">save.image<span class="punctuation">(</span><span class="string">&#x27;myfile&#x27;</span><span class="punctuation">)</span>  <span class="comment"># 保存工作空间到myfile中</span></span><br><span class="line">save<span class="punctuation">(</span>objectlist<span class="punctuation">,</span> file<span class="operator">=</span><span class="string">&#x27;myfile&#x27;</span><span class="punctuation">)</span>  <span class="comment"># 保存指定对象到myfile中</span></span><br><span class="line">load<span class="punctuation">(</span><span class="string">&#x27;myfile&#x27;</span><span class="punctuation">)</span>  <span class="comment"># 从myfile中读取一个工作空间</span></span><br></pre></td></tr></table></figure>

<h3 id="将多个df写入excel的不同位置"><a href="#将多个df写入excel的不同位置" class="headerlink" title="将多个df写入excel的不同位置"></a>将多个df写入excel的不同位置</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># path为不带文件名的文件路径</span></span><br><span class="line"><span class="comment"># file_name为带后缀的文件名</span></span><br><span class="line"><span class="comment"># souce_aw,all_aw,source_dell,all_dell均为df</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 判断是否存在文件，若存在则删除</span></span><br><span class="line"><span class="keyword">if</span><span class="punctuation">(</span>file.exists<span class="punctuation">(</span>paste<span class="punctuation">(</span>path<span class="punctuation">,</span> file_name<span class="punctuation">,</span> sep<span class="operator">=</span><span class="string">&quot;&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line">  file.remove<span class="punctuation">(</span>paste<span class="punctuation">(</span>path<span class="punctuation">,</span> file_name<span class="punctuation">,</span> sep<span class="operator">=</span><span class="string">&quot;&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 建立空工作簿</span></span><br><span class="line">dt_wb <span class="operator">&lt;-</span> createWorkbook<span class="punctuation">(</span><span class="punctuation">)</span> </span><br><span class="line"></span><br><span class="line"><span class="comment"># write_data(sheet_name, df, start_row, start_col)防止搞混这两个参数使用参数名赋值</span></span><br><span class="line">write_data<span class="punctuation">(</span><span class="string">&#x27;aw&#x27;</span><span class="punctuation">,</span> souce_aw<span class="punctuation">,</span> start_col<span class="operator">=</span><span class="number">1</span><span class="punctuation">,</span> start_row<span class="operator">=</span><span class="number">1</span><span class="punctuation">)</span></span><br><span class="line">write_data<span class="punctuation">(</span><span class="string">&#x27;aw&#x27;</span><span class="punctuation">,</span> all_aw<span class="punctuation">,</span> start_col<span class="operator">=</span><span class="number">2</span><span class="punctuation">,</span> start_row<span class="operator">=</span><span class="punctuation">(</span>nrow<span class="punctuation">(</span>souce_aw<span class="punctuation">)</span><span class="operator">+</span><span class="number">3</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">write_data<span class="punctuation">(</span><span class="string">&#x27;dell&#x27;</span><span class="punctuation">,</span> souce_dell<span class="punctuation">,</span> start_col<span class="operator">=</span><span class="number">1</span><span class="punctuation">,</span>start_row<span class="operator">=</span><span class="number">1</span><span class="punctuation">)</span></span><br><span class="line">write_data<span class="punctuation">(</span><span class="string">&#x27;dell&#x27;</span><span class="punctuation">,</span> all_dell<span class="punctuation">,</span> start_col<span class="operator">=</span><span class="number">2</span><span class="punctuation">,</span> start_row<span class="operator">=</span><span class="punctuation">(</span>nrow<span class="punctuation">(</span>souce_dell<span class="punctuation">)</span><span class="operator">+</span><span class="number">3</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 保存数据到工作簿中</span></span><br><span class="line">saveWorkbook<span class="punctuation">(</span>dt_wb<span class="punctuation">,</span> file<span class="operator">=</span>paste<span class="punctuation">(</span>path<span class="punctuation">,</span> file_name<span class="punctuation">,</span> sep<span class="operator">=</span><span class="string">&quot;&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span> </span><br></pre></td></tr></table></figure>

<h3 id="apply家族"><a href="#apply家族" class="headerlink" title="apply家族"></a>apply家族</h3><p>apply函数族是R语言中数据处理的一组核心函数，通过使用apply函数，我们可以实现对数据的<strong>循环、分组、过滤、类型控制</strong>等操作。</p>
<ul>
<li><strong>分组计算</strong>：apply（按col&#x2F;row计算）、tapply（按字段groupby计算）</li>
<li><strong>循环迭代</strong>：lapply、sapply（lapply简化版）、vapply（sapply可设置rownames）、rapply（lapply的递归版）、mapply（sapply的多参数版）</li>
<li><strong>环境空间遍历</strong>：eapply</li>
</ul>
<h4 id="apply函数"><a href="#apply函数" class="headerlink" title="apply函数"></a>apply函数</h4><p>apply函数是最常用的代替for循环的函数。apply函数可以对矩阵、数据框、数组(二维、多维)，按行或列进行循环计算，<strong>对子元素进行迭代，把子元素以参数传递的形式给自定义的FUN函数中，并返回计算结果</strong>。</p>
<ul>
<li>apply(X, MARGIN, FUN, …)</li>
<li>X:数组、矩阵、数据框</li>
<li>MARGIN: 按行计算或按按列计算，1表示按行，2表示按列</li>
<li>FUN: 自定义的调用函数</li>
<li>…: 更多参数，可选</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 最简单的实现，按行求和返回向量</span></span><br><span class="line">x <span class="operator">&lt;-</span> matrix<span class="punctuation">(</span><span class="number">1</span><span class="operator">:</span><span class="number">12</span><span class="punctuation">,</span> ncol<span class="operator">=</span><span class="number">3</span><span class="punctuation">)</span></span><br><span class="line">apply<span class="punctuation">(</span>x<span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">,</span> <span class="built_in">sum</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 自定义函数实现新增计算字段</span></span><br><span class="line">myfun <span class="operator">&lt;-</span> <span class="keyword">function</span><span class="punctuation">(</span>x<span class="punctuation">,</span> c1<span class="punctuation">,</span> c2<span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="built_in">c</span><span class="punctuation">(</span><span class="built_in">sum</span><span class="punctuation">(</span>x<span class="punctuation">[</span>c1<span class="punctuation">]</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">)</span><span class="punctuation">,</span> mean<span class="punctuation">(</span>x<span class="punctuation">[</span>c2<span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line">x <span class="operator">&lt;-</span> cbind<span class="punctuation">(</span>x1 <span class="operator">=</span> <span class="number">3</span><span class="punctuation">,</span> x2 <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">4</span><span class="operator">:</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">2</span><span class="operator">:</span><span class="number">5</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">apply<span class="punctuation">(</span>x<span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">,</span> myfun<span class="punctuation">,</span> c1<span class="operator">=</span><span class="string">&#x27;x1&#x27;</span><span class="punctuation">,</span> c2<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;x1&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;x2&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>

<h4 id="lapply函数"><a href="#lapply函数" class="headerlink" title="lapply函数"></a>lapply函数</h4><p>lapply函数是一个最基础循环操作函数之一，用来<strong>对list、data.frame数据集进行循环，并返回和X长度同样的list结构</strong>作为结果集，通过lapply的开头的第一个字母’l’就可以判断返回结果集的类型为list。</p>
<ul>
<li>lapply(X, FUN, …)</li>
<li>X:list、data.frame数据</li>
<li>FUN: 自定义的调用函数</li>
<li>…: 更多参数，可选</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 返回列表中每个key对应value的分位数</span></span><br><span class="line">x <span class="operator">&lt;-</span> <span class="built_in">list</span><span class="punctuation">(</span>a<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="operator">:</span><span class="number">10</span><span class="punctuation">)</span><span class="punctuation">,</span> b<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">1.2</span><span class="punctuation">,</span><span class="number">2.3</span><span class="punctuation">,</span><span class="number">3.4</span><span class="punctuation">,</span><span class="number">4.5</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="built_in">c</span><span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">5</span><span class="operator">:</span><span class="operator">-</span><span class="number">3</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">lapply<span class="punctuation">(</span>x<span class="punctuation">,</span> fivenum<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 当x为df时会自动分组计算并返回list</span></span><br><span class="line">x <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span>x1 <span class="operator">=</span> <span class="number">3</span><span class="punctuation">,</span> x2 <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">4</span><span class="operator">:</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">2</span><span class="operator">:</span><span class="number">5</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">lapply<span class="punctuation">(</span>x<span class="punctuation">,</span> <span class="built_in">sum</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>

<h4 id="sapply函数"><a href="#sapply函数" class="headerlink" title="sapply函数"></a>sapply函数</h4><p>sapply函数是一个<strong>简化版的lapply</strong>，sapply增加了2个参数simplify和USE.NAMES，主要就是让输出看起来更友好，<strong>返回值为向量</strong>，而不是list对象，它调用lapply函数，然后在它的基础上进行转换。</p>
<ul>
<li>sapply(X, FUN, …, simplify&#x3D;TRUE, USE.NAMES &#x3D; TRUE)</li>
<li>X:数组、矩阵、数据框</li>
<li>FUN: 自定义的调用函数</li>
<li>…: 更多参数，可选</li>
<li>simplify: 是否数组化，当值array时，输出结果按数组进行分组</li>
<li>USE.NAMES: 如果X为字符串，TRUE设置字符串为数据名，FALSE不设置</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 对矩阵进行计算，过程和lapply相同</span></span><br><span class="line">x <span class="operator">&lt;-</span> cbind<span class="punctuation">(</span>x1<span class="operator">=</span><span class="number">3</span><span class="punctuation">,</span> x2<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">2</span><span class="operator">:</span><span class="number">1</span><span class="punctuation">,</span><span class="number">4</span><span class="operator">:</span><span class="number">5</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">sapply<span class="punctuation">(</span>x<span class="punctuation">,</span> <span class="built_in">sum</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 对df进行计算</span></span><br><span class="line">sapply<span class="punctuation">(</span>data.frame<span class="punctuation">(</span>x<span class="punctuation">)</span><span class="punctuation">,</span> <span class="built_in">sum</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查结果类型，sapply返回类型为向量，而lapply的返回类型为list</span></span><br><span class="line"><span class="built_in">class</span><span class="punctuation">(</span>lapply<span class="punctuation">(</span>x<span class="punctuation">,</span> <span class="built_in">sum</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="built_in">class</span><span class="punctuation">(</span>sapply<span class="punctuation">(</span>x<span class="punctuation">,</span> <span class="built_in">sum</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 当返回结果为多个元素时会转为array</span></span><br><span class="line">sapply<span class="punctuation">(</span>x<span class="punctuation">,</span> fivenum<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 对字符型向量可自动生成数据名，设置USE.NAMES为FALSE即可</span></span><br><span class="line">sapply<span class="punctuation">(</span>sample<span class="punctuation">(</span><span class="built_in">letters</span><span class="punctuation">,</span><span class="number">5</span><span class="punctuation">)</span><span class="punctuation">,</span> paste<span class="punctuation">,</span> USE.NAMES<span class="operator">=</span><span class="literal">TRUE</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>

<h4 id="vapply函数"><a href="#vapply函数" class="headerlink" title="vapply函数"></a>vapply函数</h4><p>vapply<strong>类似于sapply</strong>，提供了FUN.VALUE参数，用来<strong>控制返回值的行名</strong>，这样可以让程序更健壮。</p>
<ul>
<li>vapply(X, FUN, FUN.VALUE, …, USE.NAMES &#x3D; TRUE)</li>
<li>X:数组、矩阵、数据框</li>
<li>FUN: 自定义的调用函数</li>
<li>FUN.VALUE: 定义返回值的行名row.names</li>
<li>…: 更多参数，可选</li>
<li>USE.NAMES: 如果X为字符串，TRUE设置字符串为数据名，FALSE不设置</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 对数据框的数据进行累计求和，并对每一行设置行名row.names</span></span><br><span class="line">x <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span>cbind<span class="punctuation">(</span>x1<span class="operator">=</span><span class="number">3</span><span class="punctuation">,</span> x2<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">2</span><span class="operator">:</span><span class="number">1</span><span class="punctuation">,</span><span class="number">4</span><span class="operator">:</span><span class="number">5</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">vapply<span class="punctuation">(</span>x<span class="punctuation">,</span><span class="built_in">cumsum</span><span class="punctuation">,</span>FUN.VALUE<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;a&#x27;</span><span class="operator">=</span><span class="number">0</span><span class="punctuation">,</span><span class="string">&#x27;b&#x27;</span><span class="operator">=</span><span class="number">0</span><span class="punctuation">,</span><span class="string">&#x27;c&#x27;</span><span class="operator">=</span><span class="number">0</span><span class="punctuation">,</span><span class="string">&#x27;d&#x27;</span><span class="operator">=</span><span class="number">0</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>

<h4 id="mapply函数"><a href="#mapply函数" class="headerlink" title="mapply函数"></a>mapply函数</h4><p>mapply也是sapply的变形函数，类似<strong>多变量的sapply</strong>，但是参数定义有些变化。第一参数为自定义的FUN函数，第二个参数’…’可以接收多个数据，作为FUN函数的参数调用。</p>
<ul>
<li>mapply(FUN, …, MoreArgs &#x3D; NULL, SIMPLIFY &#x3D; TRUE,USE.NAMES &#x3D; TRUE)</li>
<li>FUN: 自定义的调用函数</li>
<li>…: 接收多个数据</li>
<li>MoreArgs: 参数列表</li>
<li>SIMPLIFY: 是否数组化，当值array时，输出结果按数组进行分组</li>
<li>USE.NAMES: 如果X为字符串，TRUE设置字符串为数据名，FALSE不设置</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 按列对多个参数进行求和</span></span><br><span class="line">x <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span>x1<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">)</span><span class="punctuation">,</span> x2<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">3</span><span class="punctuation">,</span><span class="number">4</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">y <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span>y1<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">5</span><span class="punctuation">,</span><span class="number">6</span><span class="punctuation">)</span><span class="punctuation">,</span> y2<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">7</span><span class="punctuation">,</span><span class="number">8</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">mapply<span class="punctuation">(</span><span class="built_in">sum</span><span class="punctuation">,</span> x<span class="punctuation">,</span> y<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>

<h4 id="tapply函数"><a href="#tapply函数" class="headerlink" title="tapply函数"></a>tapply函数</h4><p>tapply用于分组的循环计算，<strong>通过INDEX参数可以把数据集X进行分组，相当于group by的操作</strong>。</p>
<ul>
<li>tapply(X, INDEX, FUN &#x3D; NULL, …, simplify &#x3D; TRUE)</li>
<li>X: 向量</li>
<li>INDEX: 用于分组的索引</li>
<li>FUN: 自定义的调用函数</li>
<li>…: 接收多个数据</li>
<li>simplify : 是否数组化，当值array时，输出结果按数组进行分组</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 对df进行groupby计算，按x1对x2进行求和</span></span><br><span class="line">x <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span>x1<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;A&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;B&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;A&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;B&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> x2<span class="operator">=</span><span class="number">1</span><span class="operator">:</span><span class="number">4</span><span class="punctuation">)</span></span><br><span class="line">with<span class="punctuation">(</span>x<span class="punctuation">,</span> <span class="punctuation">&#123;</span></span><br><span class="line">  tapply<span class="punctuation">(</span>x2<span class="punctuation">,</span> x1<span class="punctuation">,</span> <span class="built_in">sum</span><span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 特殊需求，对数字范围进行分组</span></span><br><span class="line">tapply<span class="punctuation">(</span><span class="number">1</span><span class="operator">:</span><span class="number">10</span><span class="punctuation">,</span> <span class="built_in">ceiling</span><span class="punctuation">(</span><span class="number">1</span><span class="operator">:</span><span class="number">10</span><span class="operator">/</span><span class="number">3</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="keyword">function</span><span class="punctuation">(</span>x<span class="punctuation">)</span> x<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>

<h4 id="rapply函数"><a href="#rapply函数" class="headerlink" title="rapply函数"></a>rapply函数</h4><p>rapply是一个<strong>递归版本的lapply，它只处理list类型数据</strong>，对list的每个元素进行递归遍历，如果list包括子元素则继续遍历。</p>
<ul>
<li>rapply(object, f, classes &#x3D; “ANY”, deflt &#x3D; NULL, how &#x3D; c(“unlist”, “replace”, “list”), …)</li>
<li>object:list数据</li>
<li>f: 自定义的调用函数</li>
<li>classes : 匹配类型, ANY为所有类型</li>
<li>deflt: 非匹配类型的默认值</li>
<li>how: 3种操作方式，当为replace时，则用调用f后的结果替换原list中原来的元素；当为list时，新建一个list，类型匹配调用f函数，不匹配赋值为deflt；当为unlist时，会执行一次unlist(recursive &#x3D; TRUE)的操作</li>
<li>…: 更多参数，可选</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 对一个list进行guolv，返回每一个元素的最小值，注意how参数的选取对应不同的返回结果</span></span><br><span class="line">x <span class="operator">&lt;-</span> <span class="built_in">list</span><span class="punctuation">(</span>x1<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span><span class="number">3</span><span class="punctuation">)</span><span class="punctuation">,</span> x2<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">5</span><span class="punctuation">,</span><span class="operator">-</span><span class="number">5</span><span class="punctuation">,</span><span class="number">10</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">y <span class="operator">&lt;-</span> <span class="built_in">pi</span></span><br><span class="line">z <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span>z1<span class="operator">=</span><span class="number">100</span><span class="punctuation">,</span> z2<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">11</span><span class="punctuation">,</span><span class="number">22</span><span class="punctuation">,</span><span class="number">33</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">lst <span class="operator">&lt;-</span> <span class="built_in">list</span><span class="punctuation">(</span>x<span class="operator">=</span>x<span class="punctuation">,</span> y<span class="operator">=</span>y<span class="punctuation">,</span> z<span class="operator">=</span>z<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">rapply<span class="punctuation">(</span>lst<span class="punctuation">,</span> <span class="built_in">min</span><span class="punctuation">,</span> how<span class="operator">=</span><span class="string">&#x27;list&#x27;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># classes参数用来匹配类型，与类型相匹配的元素执行函数，其余返回deflt参数值</span></span><br><span class="line">z <span class="operator">&lt;-</span> sample<span class="punctuation">(</span><span class="built_in">letters</span><span class="punctuation">,</span> <span class="number">5</span><span class="punctuation">)</span></span><br><span class="line">lst <span class="operator">&lt;-</span> <span class="built_in">list</span><span class="punctuation">(</span>x<span class="punctuation">,</span> y<span class="punctuation">,</span> z<span class="punctuation">)</span></span><br><span class="line">rapply<span class="punctuation">(</span>lst<span class="punctuation">,</span> <span class="keyword">function</span><span class="punctuation">(</span>x<span class="punctuation">)</span> paste<span class="punctuation">(</span>x<span class="punctuation">,</span> <span class="string">&#x27;---&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> classes<span class="operator">=</span><span class="string">&#x27;character&#x27;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>

<h4 id="eapply函数"><a href="#eapply函数" class="headerlink" title="eapply函数"></a>eapply函数</h4><p>对一个<strong>环境空间中的所有变量</strong>进行遍历。</p>
<ul>
<li>eapply(env, FUN, …, all.names &#x3D; FALSE, USE.NAMES &#x3D; TRUE)</li>
<li>env: 环境空间</li>
<li>FUN: 自定义的调用函数</li>
<li>…: 更多参数，可选</li>
<li>all.names: 匹配类型, ANY为所有类型</li>
<li>USE.NAMES: 如果X为字符串，TRUE设置字符串为数据名，FALSE不设置</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 新建环境并定义三个变量</span></span><br><span class="line">env1 <span class="operator">&lt;-</span> new.env<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line">env1<span class="operator">$</span>x <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="operator">:</span><span class="number">10</span><span class="punctuation">)</span></span><br><span class="line">env1<span class="operator">$</span>y <span class="operator">&lt;-</span> <span class="built_in">pi</span></span><br><span class="line">env1<span class="operator">$</span>z <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span>z1<span class="operator">=</span><span class="number">100</span><span class="punctuation">,</span> z2<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">11</span><span class="punctuation">,</span><span class="number">22</span><span class="punctuation">,</span><span class="number">33</span><span class="punctuation">)</span><span class="punctuation">)</span>  <span class="comment"># 当然它直接求不了均值</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 计算环境下所有变量的均值</span></span><br><span class="line">eapply<span class="punctuation">(</span>env1<span class="punctuation">,</span> mean<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 计算环境下所有变量的占用内存大小</span></span><br><span class="line">eapply<span class="punctuation">(</span>env1<span class="punctuation">,</span> object.size<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>

<h3 id="split和unsplit"><a href="#split和unsplit" class="headerlink" title="split和unsplit"></a>split和unsplit</h3><p>split<strong>将向量x中的数据按照f定义的分组</strong>进行划分，替换该划分所对应的值。unsplit反转split的效果。</p>
<ul>
<li>split(x, f, drop &#x3D; FALSE, …)</li>
<li>x:vector or data frame containing values to be divided into groups.</li>
<li>f:a ‘factor’ in the sense that as.factor(f) defines the grouping, or a list of such factors in which case their interaction is used for the grouping.</li>
<li>drop:logical indicating if levels that do not occur should be dropped (if f is a factor or a list).</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 按a1对df进行分组，将结果对应返回在一个列表中</span></span><br><span class="line">x <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span>x1<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;A&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;A&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;B&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> x2<span class="operator">=</span><span class="number">1</span><span class="operator">:</span><span class="number">3</span><span class="punctuation">)</span></span><br><span class="line">split<span class="punctuation">(</span>x<span class="punctuation">,</span> x<span class="operator">$</span>x1<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># unsplit是将split输出的结果按x1进行反向操作将它们合起来</span></span><br><span class="line">unsplit<span class="punctuation">(</span>split<span class="punctuation">(</span>x<span class="punctuation">,</span> x<span class="operator">$</span>x1<span class="punctuation">)</span><span class="punctuation">,</span> x<span class="operator">$</span>x1<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>

<h3 id="R中的表达式"><a href="#R中的表达式" class="headerlink" title="R中的表达式"></a>R中的表达式</h3><p>虽然我们在R终端键入的任何有效语句都是表达式，但这些表达式在输入后即被求值（evaluate）了，获得未经求值的纯粹“表达式”就要使用函数。下面我们从函数参数和返回值两方面了解expression、quote、bquote和substitute这几个常用函数。</p>
<h4 id="expression和quote函数"><a href="#expression和quote函数" class="headerlink" title="expression和quote函数"></a>expression和quote函数</h4><p>expression函数可以有一个或多个参数，它把全部参数当成一个列表，每个参数都被转成一个表达式向量，所以它的返回值是表达式列表，每个元素都是表达式类型对象，返回值的长度等于参数的个数：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># expression形成两个表达式并通过eval索引不同表达式赋值返回结果</span></span><br><span class="line">a <span class="operator">&lt;-</span> <span class="built_in">expression</span><span class="punctuation">(</span>x <span class="operator">*</span> y<span class="punctuation">,</span> x <span class="operator">+</span> y<span class="punctuation">)</span></span><br><span class="line">b <span class="operator">&lt;-</span> <span class="built_in">list</span><span class="punctuation">(</span>x<span class="operator">=</span><span class="number">10</span><span class="punctuation">,</span> y<span class="operator">=</span><span class="number">10</span><span class="punctuation">)</span></span><br><span class="line">eval<span class="punctuation">(</span>a<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">,</span> b<span class="punctuation">)</span>; eval<span class="punctuation">(</span>a<span class="punctuation">[</span><span class="number">2</span><span class="punctuation">]</span><span class="punctuation">,</span> b<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>

<p>quote函数只能有一个参数。quote函数的返回值一般情况下是call类型，表达式参数是单个变量的话返回值就是name类型，如果是常量那么返回值的存储模式就和相应常量的模式相同：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># quote构建表达式并使用eval传参计算</span></span><br><span class="line">a <span class="operator">&lt;-</span> <span class="built_in">quote</span><span class="punctuation">(</span>x <span class="operator">*</span> y<span class="punctuation">)</span></span><br><span class="line">b <span class="operator">&lt;-</span> <span class="built_in">list</span><span class="punctuation">(</span>x<span class="operator">=</span><span class="number">2</span><span class="punctuation">,</span> y<span class="operator">=</span><span class="number">10</span><span class="punctuation">)</span></span><br><span class="line">eval<span class="punctuation">(</span>a<span class="punctuation">,</span> b<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>

<h4 id="bquote和substitute函数"><a href="#bquote和substitute函数" class="headerlink" title="bquote和substitute函数"></a>bquote和substitute函数</h4><p>如果不使用环境变量或环境变量参数，bquote 和 substitute 函数得到的结果与quote函数相同。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 比较三个表达式函数</span></span><br><span class="line">bquote<span class="punctuation">(</span><span class="number">1</span> <span class="operator">+</span> <span class="built_in">sqrt</span><span class="punctuation">(</span>a<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">==</span> <span class="built_in">quote</span><span class="punctuation">(</span><span class="number">1</span> <span class="operator">+</span> <span class="built_in">sqrt</span><span class="punctuation">(</span>a<span class="punctuation">)</span><span class="punctuation">)</span>; <span class="built_in">substitute</span><span class="punctuation">(</span><span class="number">1</span> <span class="operator">+</span> <span class="built_in">sqrt</span><span class="punctuation">(</span>a<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">==</span> <span class="built_in">quote</span><span class="punctuation">(</span><span class="number">1</span> <span class="operator">+</span> <span class="built_in">sqrt</span><span class="punctuation">(</span>a<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 两者的不同之处在于赋值方式的不同，一般使用substitute</span></span><br><span class="line">a <span class="operator">&lt;-</span> 3 ; b <span class="operator">&lt;-</span> 2 </span><br><span class="line">bquote<span class="punctuation">(</span>y <span class="operator">==</span> <span class="built_in">sqrt</span><span class="punctuation">(</span>.<span class="punctuation">(</span>a<span class="punctuation">)</span><span class="punctuation">,</span> .<span class="punctuation">(</span>b<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span>; <span class="built_in">substitute</span><span class="punctuation">(</span>y <span class="operator">==</span> <span class="built_in">sqrt</span><span class="punctuation">(</span>a<span class="punctuation">,</span> b<span class="punctuation">)</span><span class="punctuation">,</span> <span class="built_in">list</span><span class="punctuation">(</span>a <span class="operator">=</span> <span class="number">3</span><span class="punctuation">,</span> b <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>

<h3 id="df删除重复行"><a href="#df删除重复行" class="headerlink" title="df删除重复行"></a>df删除重复行</h3><p>第一种方法利用<strong>group_by结合row_number</strong>函数对行进行排序，然后选取row_number为1的行则可达到删除其他重复值的效果。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">x <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span>a<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;A&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;B&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;A&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;A&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;C&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> b<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span><span class="number">3</span><span class="punctuation">,</span><span class="number">4</span><span class="punctuation">,</span><span class="number">5</span><span class="punctuation">)</span><span class="punctuation">)</span>; x</span><br><span class="line">x <span class="operator">%&gt;%</span> group_by<span class="punctuation">(</span>a<span class="punctuation">)</span> <span class="operator">%&gt;%</span> filter<span class="punctuation">(</span>row_number<span class="punctuation">(</span>a<span class="punctuation">)</span><span class="operator">==</span><span class="number">1</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span> ungroup</span><br></pre></td></tr></table></figure>

<p>第二种方法是利用自带的<strong>duplicated和distinct</strong>函数</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">x <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span>a<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;A&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;B&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;A&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;A&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;C&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> b<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span><span class="number">3</span><span class="punctuation">,</span><span class="number">4</span><span class="punctuation">,</span><span class="number">5</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># duplicated返回逻辑值，需用到索引中</span></span><br><span class="line">x<span class="punctuation">[</span>duplicated<span class="punctuation">(</span>a<span class="punctuation">)</span><span class="punctuation">,</span> <span class="punctuation">]</span></span><br><span class="line"><span class="comment"># distinct函数需指定.keep_all参数为TRUE才会返回其他字段</span></span><br><span class="line">x <span class="operator">%&gt;%</span> distinct<span class="punctuation">(</span>a<span class="punctuation">,</span> .keep_all<span class="operator">=</span><span class="built_in">T</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># 还有一个unique函数返回某一列的唯一值，这和python中一样</span></span><br><span class="line">unique<span class="punctuation">(</span>x<span class="operator">$</span>a<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>

<h3 id="partial传参和compose组合函数"><a href="#partial传参和compose组合函数" class="headerlink" title="partial传参和compose组合函数"></a>partial传参和compose组合函数</h3><p>partial用来<strong>对已有函数传入一定数量的参数</strong>形成一个类似function的partialised对象，你可以调用这个对象再次传参，就像使用函数一样使用它，这对于一些需要指定不同参数的场景特别适用。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 定义一个函数然后然后给它先传入两个参数，再次调用的时候再传入一个参数就可以了</span></span><br><span class="line">a <span class="operator">&lt;-</span> <span class="keyword">function</span><span class="punctuation">(</span>x<span class="punctuation">,</span> y<span class="punctuation">,</span> z<span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="built_in">return</span><span class="punctuation">(</span>x<span class="operator">+</span>y<span class="operator">+</span>z<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line">b <span class="operator">&lt;-</span> partial<span class="punctuation">(</span>a<span class="punctuation">,</span> x<span class="operator">=</span><span class="number">1</span><span class="punctuation">,</span> y<span class="operator">=</span><span class="number">2</span><span class="punctuation">)</span>; b</span><br><span class="line">b<span class="punctuation">(</span>z<span class="operator">=</span><span class="number">3</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>

<p>compose的作用是组合多个函数，默认从后往前的顺序执行函数。注意需传入函数function，而不是公式formula（~）</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a <span class="operator">&lt;-</span> compose<span class="punctuation">(</span><span class="keyword">function</span><span class="punctuation">(</span>x<span class="punctuation">)</span> paste<span class="punctuation">(</span>x<span class="punctuation">,</span><span class="string">&#x27;foo&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="keyword">function</span><span class="punctuation">(</span>x<span class="punctuation">)</span> paste<span class="punctuation">(</span>x<span class="punctuation">,</span><span class="string">&#x27;bar&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">a<span class="punctuation">(</span>x<span class="operator">=</span><span class="string">&#x27;input&#x27;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>

<h3 id="、-和-公式"><a href="#、-和-公式" class="headerlink" title="!!、!!!和~公式"></a>!!、!!!和~公式</h3><p>!!作用是<strong>使用外部环境的参数或者变量</strong>，在%&gt;%的过程中使用外部变量前指定!!，还有就是在函数中使用rename的时候在参数前加!!，这和R语言在特定情况下字符串不用加双引号有关。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用函数更名，在x重复的时候加!!指定左边的x使用参数，而不是字符串x</span></span><br><span class="line">re_func <span class="operator">&lt;-</span> <span class="keyword">function</span><span class="punctuation">(</span>data<span class="punctuation">,</span>x<span class="punctuation">,</span>y<span class="punctuation">)</span> rename<span class="punctuation">(</span>data<span class="punctuation">,</span> <span class="operator">!</span><span class="operator">!</span>x<span class="operator">:=</span>x<span class="punctuation">,</span> <span class="operator">!</span><span class="operator">!</span>y<span class="operator">:=</span>y<span class="punctuation">)</span></span><br><span class="line">a <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span>x<span class="operator">=</span><span class="built_in">rep</span><span class="punctuation">(</span><span class="number">1</span><span class="operator">:</span><span class="number">2</span><span class="punctuation">,</span> each<span class="operator">=</span><span class="number">3</span><span class="punctuation">)</span><span class="punctuation">,</span> y<span class="operator">=</span><span class="number">1</span><span class="operator">:</span><span class="number">6</span><span class="punctuation">,</span> z<span class="operator">=</span><span class="number">6</span><span class="operator">:</span><span class="number">1</span><span class="punctuation">)</span></span><br><span class="line">re_func<span class="punctuation">(</span>data<span class="operator">=</span>a<span class="punctuation">,</span> x<span class="operator">=</span><span class="string">&#x27;xx&#x27;</span><span class="punctuation">,</span> y<span class="operator">=</span><span class="string">&#x27;yy&#x27;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>

<p><strong>!!!作用是解包</strong>，一般针对于list类型的数据或准则exprs函数形成的list数据类型，在变量名称前加!!!，在有些情况下这是必须的。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">a <span class="operator">&lt;-</span> <span class="built_in">list</span><span class="punctuation">(</span></span><br><span class="line">  exprs<span class="punctuation">(</span>x<span class="operator">=</span><span class="number">1</span><span class="punctuation">,</span> y<span class="operator">=</span><span class="number">2</span><span class="punctuation">,</span> z<span class="operator">=</span><span class="number">3</span><span class="punctuation">)</span><span class="punctuation">,</span> </span><br><span class="line">  exprs<span class="punctuation">(</span>x<span class="operator">=</span><span class="number">9</span><span class="punctuation">,</span> y<span class="operator">=</span><span class="number">8</span><span class="punctuation">,</span> z<span class="operator">=</span><span class="number">7</span><span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">)</span></span><br><span class="line">b <span class="operator">&lt;-</span> <span class="keyword">function</span><span class="punctuation">(</span>x<span class="punctuation">,</span>y<span class="punctuation">,</span>z<span class="punctuation">)</span> x</span><br><span class="line">map<span class="punctuation">(</span>a<span class="punctuation">,</span> <span class="operator">~</span> paste<span class="punctuation">(</span>.x<span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>

<p><del>在R语言中是<strong>formula公式类型</strong>，在map等其他函数中中可以当做匿名函数来使用，调用的参数位置使用.x和.y来指定。但当函数内部指定f必须为function时，则不能使用</del>公式替代function。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">a <span class="operator">&lt;-</span> <span class="built_in">list</span><span class="punctuation">(</span></span><br><span class="line">  <span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span><span class="number">3</span><span class="punctuation">)</span><span class="punctuation">,</span> </span><br><span class="line">  <span class="built_in">c</span><span class="punctuation">(</span><span class="number">4</span><span class="punctuation">,</span><span class="number">5</span><span class="punctuation">,</span><span class="number">6</span><span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">)</span></span><br><span class="line">b <span class="operator">&lt;-</span> <span class="built_in">list</span><span class="punctuation">(</span></span><br><span class="line">  <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;a&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;b&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;c&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> </span><br><span class="line">  <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;d&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;e&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;f&#x27;</span><span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">)</span></span><br><span class="line">map<span class="punctuation">(</span>a<span class="punctuation">,</span> <span class="operator">~</span> <span class="built_in">sum</span><span class="punctuation">(</span>.x<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">map2<span class="punctuation">(</span>a<span class="punctuation">,</span> b<span class="punctuation">,</span> <span class="operator">~</span> paste<span class="punctuation">(</span>.x<span class="punctuation">,</span>.y<span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>

<h3 id="expr系列、sym系列和quo系列"><a href="#expr系列、sym系列和quo系列" class="headerlink" title="expr系列、sym系列和quo系列"></a>expr系列、sym系列和quo系列</h3><p>这三个系列都属于表达式的范畴，原理基本相同，只是在应用场景上有所不同。需要注意的是exprs、quo、get_env、get_expr和eval_tidy函数都属于rlang包，其余的则属于dplyr包。<br>先来看<strong>expr系列</strong>，这也是最常用的，适用于接受参数的场景，包括expr、exprs、enexpr、enexprs。expr和enexpr针对单个表达式或者参数，加s针对多个并返回列表；expr和exprs捕获你输入给它的表达式，enexpr和enexprs用于捕获外部输入的表达式。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 先来看expr和exprs，捕获输入的参数，输入什么返回什么</span></span><br><span class="line">expr<span class="punctuation">(</span>hello<span class="punctuation">)</span>; exprs<span class="punctuation">(</span>hello<span class="punctuation">,</span> <span class="string">&#x27;world&#x27;</span><span class="punctuation">,</span> say<span class="punctuation">(</span>hello<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 接下来是enexpr和enexprs，捕获外部传入的参数，用expr和enexpr举个例子</span></span><br><span class="line">a <span class="operator">&lt;-</span> <span class="keyword">function</span><span class="punctuation">(</span>arg<span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">  a <span class="operator">&lt;-</span> expr<span class="punctuation">(</span>arg<span class="punctuation">)</span></span><br><span class="line">  b <span class="operator">&lt;-</span> enexpr<span class="punctuation">(</span>arg<span class="punctuation">)</span></span><br><span class="line">  paste<span class="punctuation">(</span>a<span class="punctuation">,</span> b<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line">a<span class="punctuation">(</span>hello<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 接下来是使用!!传入参数所对应的数据，当然如果传入hello是字符串就只会返回字符串了</span></span><br><span class="line">hello <span class="operator">&lt;-</span> 333</span><br><span class="line">b <span class="operator">&lt;-</span> <span class="keyword">function</span><span class="punctuation">(</span>arg<span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">  b <span class="operator">&lt;-</span> expr<span class="punctuation">(</span><span class="operator">!</span><span class="operator">!</span>arg<span class="punctuation">)</span></span><br><span class="line">  b</span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line">b<span class="punctuation">(</span>hello<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>

<p><strong>sym系列</strong>的作用和expr差不多，但是<strong>只接受传入字符串类型</strong>，传入符号会报错，syms的传参方式也略有不同</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sym和base包中的quote差不多，syms需使用list传入字符串</span></span><br><span class="line">sym<span class="punctuation">(</span><span class="string">&#x27;a&#x27;</span><span class="punctuation">)</span>; syms<span class="punctuation">(</span><span class="built_in">list</span><span class="punctuation">(</span><span class="string">&#x27;a&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;b&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ensyms也是接收传入的参数，只接受字符串类型</span></span><br><span class="line">hello <span class="operator">&lt;-</span> <span class="string">&#x27;world&#x27;</span></span><br><span class="line">a <span class="operator">&lt;-</span> <span class="keyword">function</span><span class="punctuation">(</span>...<span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">  a <span class="operator">&lt;-</span> ensyms<span class="punctuation">(</span>...<span class="punctuation">)</span></span><br><span class="line">  a</span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line">a<span class="punctuation">(</span>he<span class="punctuation">,</span> <span class="string">&#x27;llo&#x27;</span><span class="punctuation">,</span> <span class="operator">!</span><span class="operator">!</span>hello<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>

<p>最后是<strong>quo系列，它是一个包含环境的表达式</strong>，而且要用到自带的eval_tidy函数进行求值。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># quo定义了一个包含表达式和当前环境的对象，使用get_expr和get_env可以取出表达式和所在的环境</span></span><br><span class="line">quo_eg <span class="operator">&lt;-</span> rlang<span class="operator">::</span>quo<span class="punctuation">(</span>sample<span class="punctuation">(</span><span class="built_in">letters</span><span class="punctuation">,</span> <span class="number">5</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">quo_eg; rlang<span class="operator">::</span>get_expr<span class="punctuation">(</span>quo_eg<span class="punctuation">)</span>; rlang<span class="operator">::</span>get_env<span class="punctuation">(</span>quo_eg<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 接下来使用enquo在函数环境中接受参数，和函数空间中的变量运算后返回值</span></span><br><span class="line">a <span class="operator">&lt;-</span> <span class="keyword">function</span><span class="punctuation">(</span>arg<span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">  a <span class="operator">&lt;-</span> enquo<span class="punctuation">(</span>arg<span class="punctuation">)</span></span><br><span class="line">  b <span class="operator">&lt;-</span> 10</span><br><span class="line">  rlang<span class="operator">::</span>quo<span class="punctuation">(</span><span class="operator">!</span><span class="operator">!</span>a <span class="operator">*</span> b<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="comment"># 计算它的时候它调用的是函数内部的a和b，env指的也是函数的内部环境</span></span><br><span class="line">a<span class="punctuation">(</span><span class="number">2</span><span class="operator">+</span><span class="number">3</span><span class="punctuation">)</span>; a<span class="punctuation">(</span><span class="number">2</span><span class="operator">+</span><span class="number">3</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span> rlang<span class="operator">::</span>eval_tidy<span class="punctuation">(</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>

<h3 id="map、reduce和map-df"><a href="#map、reduce和map-df" class="headerlink" title="map、reduce和map_df"></a>map、reduce和map_df</h3><p>map函数是将x中的每一个元素进行函数计算，map(1:3,f)等价于list(f(1),f(2),f(3))，相当于任务的分解，分发，而reduce是重复进行函数操作，相当于组合。<br>将map、reduce和map_df放在一起说是因为在特定情况下两个函数可以实现的结果是相同的，其他的map函数需要的时候再去查。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用map函数实现分而治之</span></span><br><span class="line">a <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span><span class="number">3</span><span class="punctuation">)</span></span><br><span class="line">map<span class="punctuation">(</span>a<span class="punctuation">,</span> <span class="operator">~</span>paste<span class="punctuation">(</span>.x<span class="punctuation">,</span> <span class="string">&#x27;ww&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># map结合reduce实现先分发再组合</span></span><br><span class="line">map<span class="punctuation">(</span>a<span class="punctuation">,</span> <span class="operator">~</span>paste<span class="punctuation">(</span>.x<span class="punctuation">,</span> <span class="string">&#x27;ww&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span> reduce<span class="punctuation">(</span>.<span class="punctuation">,</span> paste<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># map_df会把计算后的结果拼接起来，省略了reeduce的操作，但只限于数据框</span></span><br><span class="line">a <span class="operator">&lt;-</span> tibble<span class="punctuation">(</span>x<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;d&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;a&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;a&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;b&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;b&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;c&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;c&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;c&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> </span><br><span class="line">            y<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span><span class="number">3</span><span class="punctuation">,</span><span class="number">3</span><span class="punctuation">)</span><span class="punctuation">,</span> </span><br><span class="line">            z<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span><span class="number">3</span><span class="punctuation">,</span><span class="number">4</span><span class="punctuation">,</span><span class="number">5</span><span class="punctuation">,</span><span class="number">6</span><span class="punctuation">,</span><span class="number">7</span><span class="punctuation">,</span><span class="number">8</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># 将a按y分成多个list元素，然后再分别对每个元素进行group_by计算，最后map_df会自动给我们把计算结果合并起来</span></span><br><span class="line">a <span class="operator">%&gt;%</span> split<span class="punctuation">(</span>.<span class="operator">$</span>y<span class="punctuation">)</span> <span class="operator">%&gt;%</span> map_df<span class="punctuation">(</span>.<span class="punctuation">,</span> <span class="operator">~</span>group_by<span class="punctuation">(</span>.<span class="punctuation">,</span>.<span class="operator">$</span>x<span class="punctuation">)</span> <span class="operator">%&gt;%</span> summarise<span class="punctuation">(</span><span class="built_in">sum</span><span class="operator">=</span><span class="built_in">sum</span><span class="punctuation">(</span>z<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># 再来看看map、reduce的计算结果，是一样的</span></span><br><span class="line">a <span class="operator">%&gt;%</span> split<span class="punctuation">(</span>.<span class="operator">$</span>y<span class="punctuation">)</span> <span class="operator">%&gt;%</span> map<span class="punctuation">(</span>.<span class="punctuation">,</span> <span class="operator">~</span>group_by<span class="punctuation">(</span>.<span class="punctuation">,</span>.<span class="operator">$</span>x<span class="punctuation">)</span> <span class="operator">%&gt;%</span> summarise<span class="punctuation">(</span><span class="built_in">sum</span><span class="operator">=</span><span class="built_in">sum</span><span class="punctuation">(</span>z<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span> reduce<span class="punctuation">(</span>rbind<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>

<p>map_df这种情况适用于分批次查询或者计算MySQL数据库的时候，会减少数据库的查询压力，当然得结果split(data, ceiling(1:len(data)&#x2F;n))来使用，它会将数据将数据转换成list中的元素，每个元素长度为n，然后依次排列，这样就达到了分批次（每次执行数量为n）进行查询或者计算操作了。</p>
<h3 id="ES查询相关"><a href="#ES查询相关" class="headerlink" title="ES查询相关"></a>ES查询相关</h3><p>ES的查询需要借助到elastic库和esHelp库，elastic库主要是建立连接并查询返回，esHelp库则着重于查询条件body的辅助编写，使用它可以快速形成json格式的查询条件。</p>
<h4 id="建立连接和数据转换"><a href="#建立连接和数据转换" class="headerlink" title="建立连接和数据转换"></a>建立连接和数据转换</h4><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用elastic库带的connect方法建立连接</span></span><br><span class="line">con_51 <span class="operator">&lt;-</span> connect<span class="punctuation">(</span>host <span class="operator">=</span> <span class="string">&quot;47.92.156.202&quot;</span><span class="punctuation">,</span> user <span class="operator">=</span> <span class="string">&#x27;readonly&#x27;</span><span class="punctuation">,</span> pwd <span class="operator">=</span> <span class="string">&#x27;wczyyqc&#x27;</span><span class="punctuation">,</span> port <span class="operator">=</span> <span class="string">&#x27;9201&#x27;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询后的数据整理，基本可以用着一个函数转换</span></span><br><span class="line">modifydata <span class="operator">&lt;-</span> <span class="keyword">function</span><span class="punctuation">(</span>x<span class="punctuation">)</span> map<span class="punctuation">(</span>x<span class="punctuation">,</span> <span class="string">&quot;_source&quot;</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span> transpose <span class="operator">%&gt;%</span>  map<span class="punctuation">(</span>unlist<span class="punctuation">)</span> <span class="operator">%&gt;%</span> as_tibble<span class="punctuation">(</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>

<h4 id="查询语句body的编写"><a href="#查询语句body的编写" class="headerlink" title="查询语句body的编写"></a>查询语句body的编写</h4><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查询语句有两种写法，层层嵌套和快速生成</span></span><br><span class="line">stime <span class="operator">&lt;-</span> <span class="string">&#x27;2020-11-01 00:00:00&#x27;</span></span><br><span class="line">stime <span class="operator">&lt;-</span> <span class="string">&#x27;2020-11-01 23:59:59&#x27;</span></span><br><span class="line">es_a <span class="operator">&lt;-</span> elastic_q<span class="punctuation">(</span>query<span class="punctuation">(</span>bool<span class="punctuation">(</span>filter<span class="punctuation">(</span>between<span class="punctuation">(</span>local_time<span class="punctuation">,</span> stime<span class="punctuation">,</span> etime<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                                            event <span class="operator">%in%</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;subscribe&#x27;</span><span class="punctuation">,</span> <span class="string">&quot;SCAN&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                                            route<span class="operator">==</span><span class="string">&quot;pages/index/index&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                            <span class="operator">?</span>options.fromopenid<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">%+%</span></span><br><span class="line">                            elastic_s<span class="punctuation">(</span><span class="built_in">list</span><span class="punctuation">(</span><span class="string">&quot;openid&quot;</span><span class="punctuation">,</span><span class="string">&quot;local_time&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span> </span><br><span class="line">es_b <span class="operator">&lt;-</span> bool_query<span class="punctuation">(</span>between<span class="punctuation">(</span>local_time<span class="punctuation">,</span> stime<span class="punctuation">,</span> etime<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                                            event <span class="operator">%in%</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;subscribe&#x27;</span><span class="punctuation">,</span> <span class="string">&quot;SCAN&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                                            route<span class="operator">==</span><span class="string">&quot;pages/index/index&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                            <span class="operator">?</span>options.fromopenid<span class="punctuation">)</span> <span class="operator">%+%</span> </span><br><span class="line">        <span class="built_in">list</span><span class="punctuation">(</span>`_source`<span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;openid&quot;</span><span class="punctuation">,</span><span class="string">&quot;local_time&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 上方两种写法的结果是一样的(1.1版本)，看看转成json后的结果</span></span><br><span class="line">es_a <span class="operator">=</span> es_b; es_b <span class="operator">%&gt;%</span> jsonlite<span class="operator">::</span>toJSON<span class="punctuation">(</span>pretty <span class="operator">=</span> <span class="built_in">T</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>

<p>因为esHelp版本问题，结果应该如下文所示，意思是筛选local_time从stime到etime，event字段包含”subscribe”,”SCAN”，是否存在”options.fromopenid”字段并最终取出”openid”,”local_time”字段</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;bool&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;filter&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line">                <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;range&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;local_time&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">                            <span class="attr">&quot;gte&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="string">&quot;2020-11-01 00:00:00&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">                            <span class="attr">&quot;lte&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="string">&quot;2020-11-01 23:59:59&quot;</span><span class="punctuation">]</span></span><br><span class="line">                        <span class="punctuation">&#125;</span></span><br><span class="line">                    <span class="punctuation">&#125;</span></span><br><span class="line">                <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;terms&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;event&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="string">&quot;subscribe&quot;</span><span class="punctuation">,</span><span class="string">&quot;SCAN&quot;</span><span class="punctuation">]</span></span><br><span class="line">                    <span class="punctuation">&#125;</span></span><br><span class="line">                <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;term&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;route&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="string">&quot;pages/index/index&quot;</span><span class="punctuation">]</span></span><br><span class="line">                    <span class="punctuation">&#125;</span></span><br><span class="line">                <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;exists&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="string">&quot;options.fromopenid&quot;</span><span class="punctuation">]</span></span><br><span class="line">                    <span class="punctuation">&#125;</span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;_source&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="string">&quot;openid&quot;</span><span class="punctuation">,</span><span class="string">&quot;local_time&quot;</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h4 id="查询语句的传入"><a href="#查询语句的传入" class="headerlink" title="查询语句的传入"></a>查询语句的传入</h4><p>使用elastic自带的函数传入相关参数后再转换即可</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 传入上方的连接con，index（db）， type（table）和body参数，再把data传入modifydata中即可得到二维数据。</span></span><br><span class="line">es_tmp_exp  <span class="operator">&lt;-</span> <span class="keyword">function</span><span class="punctuation">(</span>con <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">,</span>  index<span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">,</span> body<span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">,</span> time_scroll<span class="operator">=</span> <span class="string">&#x27;10s&#x27;</span><span class="punctuation">,</span>... <span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"></span><br><span class="line">  res <span class="operator">&lt;-</span> Search<span class="punctuation">(</span>conn <span class="operator">=</span> con<span class="punctuation">,</span> index<span class="operator">=</span> index<span class="punctuation">,</span> body<span class="operator">=</span> body<span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">10000</span><span class="punctuation">,</span>  time_scroll<span class="operator">=</span> time_scroll<span class="punctuation">,</span>...<span class="punctuation">)</span></span><br><span class="line">  <span class="built_in">on.exit</span><span class="punctuation">(</span>expr <span class="operator">=</span> scroll_clear<span class="punctuation">(</span>conn <span class="operator">=</span> con<span class="punctuation">,</span> x <span class="operator">=</span> res<span class="operator">$</span>`_scroll_id`<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">  data <span class="operator">&lt;-</span> <span class="built_in">list</span><span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> <span class="punctuation">(</span><span class="built_in">T</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line"></span><br><span class="line">    data <span class="operator">&lt;-</span>  <span class="built_in">c</span><span class="punctuation">(</span>data<span class="punctuation">,</span> res<span class="operator">$</span>hits<span class="operator">$</span>hits<span class="punctuation">)</span>  </span><br><span class="line"></span><br><span class="line">    res <span class="operator">&lt;-</span> scroll<span class="punctuation">(</span>conn <span class="operator">=</span> con<span class="punctuation">,</span> x<span class="operator">=</span> res<span class="operator">$</span>`_scroll_id` <span class="punctuation">,</span> time_scroll<span class="operator">=</span> time_scroll<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="punctuation">(</span><span class="built_in">length</span><span class="punctuation">(</span>res<span class="operator">$</span>hits<span class="operator">$</span>hits<span class="punctuation">)</span> <span class="operator">==</span><span class="number">0</span> <span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line">      <span class="keyword">break</span> </span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">return</span><span class="punctuation">(</span>data<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="发送邮件"><a href="#发送邮件" class="headerlink" title="发送邮件"></a>发送邮件</h3><p>通过mailR库发送邮件，只需要一个主体即可把所有参数全部传完。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">library<span class="punctuation">(</span>mailR<span class="punctuation">)</span></span><br><span class="line">  mailR<span class="operator">::</span>send.mail<span class="punctuation">(</span>from <span class="operator">=</span> <span class="string">&quot;eub_bi@eub-inc.com&quot;</span><span class="punctuation">,</span>  <span class="comment"># 发件人</span></span><br><span class="line">                   to <span class="operator">=</span> <span class="string">&quot;di.cui@eub-inc.com&quot;</span><span class="punctuation">,</span>  <span class="comment"># 收件人</span></span><br><span class="line">                   cc <span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;frank@eub-inc.com&quot;</span><span class="punctuation">,</span> <span class="string">&quot;xukun.wang@eub-inc.com&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span>  <span class="comment"># 抄送人</span></span><br><span class="line">                   subject <span class="operator">=</span> <span class="string">&quot;dell&amp;aw仍在关粉丝人群渠道分布&quot;</span><span class="punctuation">,</span>  <span class="comment"># 邮件主题</span></span><br><span class="line">                   body <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;Dear all，</span></span><br><span class="line"><span class="string">                     dell&amp;aw仍在关粉丝人群渠道分布数据如下附件，请注意查收。&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span>  <span class="comment"># 邮件内容</span></span><br><span class="line">                   smtp <span class="operator">=</span> <span class="built_in">list</span><span class="punctuation">(</span>host.name <span class="operator">=</span> <span class="string">&quot;smtp.exmail.qq.com&quot;</span><span class="punctuation">,</span> port <span class="operator">=</span><span class="number">25</span><span class="punctuation">,</span>user.name<span class="operator">=</span><span class="string">&quot;eub_bi@eub-inc.com&quot;</span><span class="punctuation">,</span></span><br><span class="line">                               passwd <span class="operator">=</span> <span class="string">&quot;Eubbi0719&quot;</span><span class="punctuation">,</span> ssl <span class="operator">=</span><span class="literal">TRUE</span><span class="punctuation">,</span>tls<span class="operator">=</span><span class="literal">FALSE</span><span class="punctuation">)</span><span class="punctuation">,</span>  <span class="comment"># 邮箱的host name 和passwd配置</span></span><br><span class="line">                   authenticate <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span></span><br><span class="line">                   send <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span>  <span class="comment"># 是否立即发送</span></span><br><span class="line">                   attach.files <span class="operator">=</span> path<span class="punctuation">,</span>  <span class="comment"># 附件地址</span></span><br><span class="line">                   encoding <span class="operator">=</span> <span class="string">&quot;utf-8&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>

<h3 id="R脚本运行自检测"><a href="#R脚本运行自检测" class="headerlink" title="R脚本运行自检测"></a>R脚本运行自检测</h3><p>检测R脚本是否可以在初始环境中运行<br>首先在Rstudio中按Common&#x2F;Ctrl+Shift+F10键重启环境，这时只有初始的环境，使用search命令查看基础包<br>然后在终端中键入Rscript 脚本名称来测试脚本是否可以运行，若不可以运行应该是缺少相关依赖包，导入即可</p>
<h3 id="打包数据"><a href="#打包数据" class="headerlink" title="打包数据"></a>打包数据</h3><p>使用base库自带的list.files和zip即可完成打包</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># path为需要打包的所有文件的上级目录</span></span><br><span class="line">path <span class="operator">&lt;-</span> <span class="string">&#x27;/home/dingtao/wangxukun/data/dell/dell_scan_subcribe_log/&#x27;</span></span><br><span class="line">path_name <span class="operator">&lt;-</span> list.files<span class="punctuation">(</span>path<span class="punctuation">)</span></span><br><span class="line">zip<span class="punctuation">(</span><span class="string">&#x27;filename.zip&#x27;</span><span class="punctuation">,</span> path_name<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>

<h3 id="解析json字符串"><a href="#解析json字符串" class="headerlink" title="解析json字符串"></a>解析json字符串</h3><p>要解决的是解析tibble中某一列存在json字符串的情况</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用map的时候需要把空字符串筛掉 不然会报错 在map中加上mutate会找到解析后对应的字符串</span></span><br><span class="line">address <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span></span><br><span class="line"><span class="string">&#x27;&#123;&quot;nationalCode&quot;:&quot;440402&quot;,&quot;telNumber&quot;:&quot;13539585518&quot;,&quot;errMsg&quot;:&quot;chooseAddress:ok&quot;,&quot;userName&quot;:&quot;侯艳玲&quot;,&quot;postalCode&quot;:&quot;519000&quot;,&quot;provinceName&quot;:&quot;广东省&quot;,&quot;cityName&quot;:&quot;珠海市&quot;,&quot;countyName&quot;:&quot;香洲区&quot;,&quot;detailInfo&quot;:&quot;泰来花园商铺19号 黄拯邦中医诊所&quot;&#125;&#x27;</span><span class="punctuation">,</span></span><br><span class="line"><span class="string">&#x27;&#123;&quot;errMsg&quot;:&quot;chooseAddress:ok&quot;,&quot;userName&quot;:&quot;韩嘉乐&quot;,&quot;telNumber&quot;:&quot;19826080561&quot;,&quot;nationalCode&quot;:&quot;320322&quot;,&quot;postalCode&quot;:&quot;221600&quot;,&quot;provinceName&quot;:&quot;江苏省&quot;,&quot;cityName&quot;:&quot;徐州市&quot;,&quot;countyName&quot;:&quot;沛县&quot;,&quot;detailInfo&quot;:&quot;龙固镇&quot;&#125;&#x27;</span><span class="punctuation">,</span></span><br><span class="line"><span class="string">&#x27;&#123;&quot;errMsg&quot;:&quot;chooseAddress:ok&quot;,&quot;userName&quot;:&quot;宋俊纬&quot;,&quot;telNumber&quot;:&quot;13355332907&quot;,&quot;nationalCode&quot;:&quot;370305&quot;,&quot;postalCode&quot;:&quot;255400&quot;,&quot;provinceName&quot;:&quot;山东省&quot;,&quot;cityName&quot;:&quot;淄博市&quot;,&quot;countyName&quot;:&quot;临淄区&quot;,&quot;detailInfo&quot;:&quot;绿茵花园&quot;&#125;&#x27;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">a <span class="operator">&lt;-</span> tibble<span class="punctuation">(</span>address<span class="operator">=</span>address<span class="punctuation">)</span></span><br><span class="line">a<span class="operator">$</span>address <span class="operator">%&gt;%</span> map_df<span class="punctuation">(</span>.<span class="punctuation">,</span> <span class="operator">~</span>jsonlite<span class="operator">::</span>fromJSON<span class="punctuation">(</span>..1<span class="punctuation">)</span> <span class="operator">%&gt;%</span> as_tibble<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span> mutate<span class="punctuation">(</span>address<span class="operator">=</span>..1<span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>

<h3 id="S3类-amp-泛型函数"><a href="#S3类-amp-泛型函数" class="headerlink" title="S3类&amp;泛型函数"></a>S3类&amp;泛型函数</h3><ul>
<li>S3类内部是一个列表，附加一个列表类名称，可以成为该类。list里面的内容就是我们所说的属性；</li>
<li>S3类可以继承，在原来类的基础上再append一个新的类名即为新的类；</li>
<li>类中除了含有属性外，肯定还得含有方法。使用某方法.某类来创建某类的方法。比如print.gg就是对gg类的print的方法。但是在创建这种方法之前我们首先得用这个方法的名字创建一个函数，这样运行函数时首先进入这个函数，然后在函数里面使用useMethod函数，在环境中寻找该类的该方法；</li>
<li>default函数，表示默认的方法，如果该类找不到该类匹配的方法，就会使用默认方法；</li>
<li>调用方法的时候会按照从左到右的顺序，再这个例子中，默认先调用a的方法，如果想要调用f类的方法，首先写一个f的qwe方法，然后在a类中调用下一类的方法，使用NextMethod。</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 构建S3类</span></span><br><span class="line">dd <span class="operator">&lt;-</span> <span class="keyword">function</span><span class="punctuation">(</span>sep<span class="operator">=</span><span class="string">&#x27;abc&#x27;</span><span class="punctuation">,</span>arg<span class="operator">=</span><span class="number">10</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span>  <span class="comment"># 创建一个S3类</span></span><br><span class="line">  ls <span class="operator">&lt;-</span> <span class="built_in">list</span><span class="punctuation">(</span></span><br><span class="line">      sep <span class="operator">=</span> sep<span class="punctuation">,</span></span><br><span class="line">    arg <span class="operator">=</span> arg</span><br><span class="line">  <span class="punctuation">)</span></span><br><span class="line">  <span class="built_in">class</span><span class="punctuation">(</span>ls<span class="punctuation">)</span> <span class="operator">&lt;-</span> append<span class="punctuation">(</span><span class="built_in">class</span><span class="punctuation">(</span>ls<span class="punctuation">)</span><span class="punctuation">,</span> <span class="string">&#x27;dd&#x27;</span><span class="punctuation">)</span></span><br><span class="line">  <span class="built_in">return</span><span class="punctuation">(</span>ls<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line">dd<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line">dd<span class="punctuation">(</span><span class="string">&#x27;qaz&#x27;</span><span class="punctuation">,</span><span class="number">100</span><span class="punctuation">)</span>  <span class="comment"># 类的实例化</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 类继承</span></span><br><span class="line">ddd <span class="operator">&lt;-</span> dd<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"><span class="built_in">class</span><span class="punctuation">(</span>ddd<span class="punctuation">)</span> <span class="operator">&lt;-</span> append<span class="punctuation">(</span><span class="built_in">class</span><span class="punctuation">(</span>ddd<span class="punctuation">)</span><span class="punctuation">,</span> <span class="string">&#x27;cc&#x27;</span><span class="punctuation">)</span>  <span class="comment"># S3类可以继承，在原来类的基础上再append一个新的类名即为新的类</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 在父类中使用子类的方法</span></span><br><span class="line">a <span class="operator">&lt;-</span> <span class="built_in">list</span><span class="punctuation">(</span>d<span class="operator">=</span><span class="string">&#x27;求和&#x27;</span><span class="punctuation">)</span></span><br><span class="line">b <span class="operator">&lt;-</span> <span class="built_in">list</span><span class="punctuation">(</span>d<span class="operator">=</span><span class="string">&#x27;平均值&#x27;</span><span class="punctuation">)</span></span><br><span class="line">d <span class="operator">&lt;-</span> <span class="built_in">list</span><span class="punctuation">(</span>d<span class="operator">=</span><span class="string">&#x27;中位值&#x27;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">aa <span class="operator">&lt;-</span> <span class="keyword">function</span><span class="punctuation">(</span><span class="punctuation">)</span> structure<span class="punctuation">(</span>a<span class="punctuation">,</span> <span class="built_in">class</span><span class="operator">=</span><span class="string">&#x27;a&#x27;</span><span class="punctuation">)</span>  <span class="comment"># 给属性列表自定义class属性值a</span></span><br><span class="line">bb <span class="operator">&lt;-</span> <span class="keyword">function</span><span class="punctuation">(</span><span class="punctuation">)</span> structure<span class="punctuation">(</span>b<span class="punctuation">,</span> <span class="built_in">class</span><span class="operator">=</span><span class="string">&#x27;b&#x27;</span><span class="punctuation">)</span></span><br><span class="line">dd <span class="operator">&lt;-</span> <span class="keyword">function</span><span class="punctuation">(</span><span class="punctuation">)</span> structure<span class="punctuation">(</span>b<span class="punctuation">,</span> <span class="built_in">class</span><span class="operator">=</span><span class="string">&#x27;d&#x27;</span><span class="punctuation">)</span></span><br><span class="line">ff <span class="operator">&lt;-</span> aa<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"><span class="built_in">class</span><span class="punctuation">(</span>ff<span class="punctuation">)</span> <span class="operator">&lt;-</span> append<span class="punctuation">(</span><span class="built_in">class</span><span class="punctuation">(</span>ff<span class="punctuation">)</span><span class="punctuation">,</span> <span class="string">&#x27;f&#x27;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">qwe <span class="operator">&lt;-</span> <span class="keyword">function</span><span class="punctuation">(</span>x<span class="punctuation">)</span> <span class="built_in">UseMethod</span><span class="punctuation">(</span><span class="string">&#x27;qwe&#x27;</span><span class="punctuation">)</span></span><br><span class="line">qwe.a <span class="operator">&lt;-</span> <span class="keyword">function</span><span class="punctuation">(</span>x<span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">  print<span class="punctuation">(</span><span class="string">&#x27;我是a类型&#x27;</span><span class="punctuation">)</span></span><br><span class="line">  NextMethod<span class="punctuation">(</span><span class="string">&#x27;qwe&#x27;</span><span class="punctuation">)</span>  <span class="comment"># 使用NextMothod函数调用a类型的子类，</span></span><br><span class="line">  x<span class="operator">$</span>d  <span class="comment"># 只有上方代码是调用子类，这里仍然是调用a类型</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line">qwe.f <span class="operator">&lt;-</span> <span class="keyword">function</span><span class="punctuation">(</span>x<span class="punctuation">)</span> print<span class="punctuation">(</span><span class="string">&#x27;我是f类型&#x27;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">qwe<span class="punctuation">(</span>ff<span class="punctuation">)</span>  <span class="comment"># （我是a类型 我是f类型 求和）使用NextMethod方法后调用子类方法</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 构建S3类的泛型函数</span></span><br><span class="line"></span><br><span class="line">ab <span class="operator">&lt;-</span> <span class="keyword">function</span><span class="punctuation">(</span>x<span class="punctuation">)</span> <span class="built_in">UseMethod</span><span class="punctuation">(</span><span class="string">&#x27;ab&#x27;</span><span class="punctuation">)</span>  <span class="comment"># 创建泛型函数</span></span><br><span class="line">ab.default <span class="operator">&lt;-</span> <span class="keyword">function</span><span class="punctuation">(</span>x<span class="punctuation">)</span> <span class="string">&#x27;default&#x27;</span>  <span class="comment"># 默认函数</span></span><br><span class="line">ab.a <span class="operator">&lt;-</span> <span class="keyword">function</span><span class="punctuation">(</span>x<span class="punctuation">)</span> x<span class="operator">$</span>d  <span class="comment"># 根据不同的class属性值创建不同的泛型函数</span></span><br><span class="line">ab.b <span class="operator">&lt;-</span> <span class="keyword">function</span><span class="punctuation">(</span>x<span class="punctuation">)</span> x<span class="operator">$</span>d</span><br><span class="line"></span><br><span class="line">ab<span class="punctuation">(</span>aa<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span>  <span class="comment"># （求和）这样在给泛型函数传入不同属性的列表参数就会运行对应属性的泛型函数</span></span><br><span class="line">ab<span class="punctuation">(</span>bb<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span>  <span class="comment"># （平均值）</span></span><br><span class="line">ab<span class="punctuation">(</span>dd<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span>  <span class="comment"># （default）没有对应d的方法，调用默认函数</span></span><br></pre></td></tr></table></figure>

<h3 id="stringr包"><a href="#stringr包" class="headerlink" title="stringr包"></a>stringr包</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># boundary用修饰符函数控制匹配行为</span></span><br><span class="line">boundary<span class="punctuation">(</span>type <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;character&quot;</span><span class="punctuation">,</span> <span class="string">&quot;line_break&quot;</span><span class="punctuation">,</span> <span class="string">&quot;sentence&quot;</span><span class="punctuation">,</span> <span class="string">&quot;word&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> skip_word_none <span class="operator">=</span> <span class="literal">NA</span><span class="punctuation">,</span> ...<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># str_detect判断子字符串是否存在于目标字符串中，返回TURE或FALSE</span></span><br><span class="line">str_detect<span class="punctuation">(</span><span class="string">&#x27;abcde&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;dcd&#x27;</span><span class="punctuation">)</span>  <span class="comment"># TRUE</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># str_count判断字符/单词长度</span></span><br><span class="line">str_count<span class="punctuation">(</span><span class="string">&#x27;abc _de&#x27;</span><span class="punctuation">)</span>  <span class="comment"># 7，默认计算字符长度</span></span><br><span class="line">str_count<span class="punctuation">(</span><span class="string">&#x27;abc _de&#x27;</span><span class="punctuation">,</span> boundary<span class="punctuation">(</span><span class="string">&#x27;character&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span>  <span class="comment"># 7</span></span><br><span class="line">str_count<span class="punctuation">(</span><span class="string">&#x27;abc _de&#x27;</span><span class="punctuation">,</span> boundary<span class="punctuation">(</span><span class="string">&#x27;character&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span>  <span class="comment"># 2，返回单词长度，数字、字符和下划线被认为是一个单词</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># str_split拆分字符串</span></span><br><span class="line">str_split<span class="punctuation">(</span><span class="string">&#x27;as b-+_1&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;-&#x27;</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span> unlist<span class="punctuation">(</span><span class="punctuation">)</span>  <span class="comment"># &quot;as b&quot; &quot;+_1&quot; ，按指定字符串拆分</span></span><br><span class="line">str_split<span class="punctuation">(</span><span class="string">&#x27;as b-+_1&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;&#x27;</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span> unlist<span class="punctuation">(</span><span class="punctuation">)</span>  <span class="comment"># &quot;a&quot; &quot;s&quot; &quot; &quot; &quot;b&quot; &quot;-&quot; &quot;+&quot; &quot;_&quot; &quot;1&quot;，拆分为单个字符</span></span><br><span class="line">str_split<span class="punctuation">(</span><span class="string">&#x27;qbc 1ff+2eqw_we&#x27;</span><span class="punctuation">,</span> boundary<span class="punctuation">(</span><span class="string">&#x27;word&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span> unlist<span class="punctuation">(</span><span class="punctuation">)</span>  <span class="comment"># &quot;qbc&quot; &quot;1ff&quot; &quot;2eqw_we&quot;，按单词分隔</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># str_extract_all按正则表达式提取所有符合条件的子字符串，str_extract只提取第一个</span></span><br><span class="line">str_extract_all<span class="punctuation">(</span><span class="string">&quot;The Cat in the Hat&quot;</span><span class="punctuation">,</span> <span class="string">&quot;[a-z]+&quot;</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span> unlist<span class="punctuation">(</span><span class="punctuation">)</span>  <span class="comment"># &quot;he&quot;  &quot;at&quot;  &quot;in&quot;  &quot;the&quot; &quot;at&quot; </span></span><br><span class="line">str_extract_all<span class="punctuation">(</span><span class="string">&quot;The Cat in the Hat&quot;</span><span class="punctuation">,</span> <span class="string">&quot;at&quot;</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span> unlist<span class="punctuation">(</span><span class="punctuation">)</span>  <span class="comment"># &quot;at&quot; &quot;at&quot;</span></span><br><span class="line">str_extract<span class="punctuation">(</span><span class="string">&quot;The Cat in the Hat&quot;</span><span class="punctuation">,</span> <span class="string">&quot;[a-z]+&quot;</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span> unlist<span class="punctuation">(</span><span class="punctuation">)</span>  <span class="comment"># &quot;he&quot;</span></span><br><span class="line">str_extract<span class="punctuation">(</span><span class="string">&quot;The Cat in the Hat&quot;</span><span class="punctuation">,</span> <span class="string">&quot;at&quot;</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span> unlist<span class="punctuation">(</span><span class="punctuation">)</span>  <span class="comment"># &quot;at&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># str_c将多个字符串连接成一个字符串</span></span><br><span class="line">str_c<span class="punctuation">(</span><span class="string">&#x27;+&#x27;</span><span class="punctuation">,</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;a&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;b&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;c&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span><span class="string">&#x27;:&#x27;</span><span class="punctuation">)</span>  <span class="comment"># &quot;+a:&quot; &quot;+b:&quot; &quot;+c:&quot;，将多个字符串连接成一个字符串</span></span><br><span class="line">str_c<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;a&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;b&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;c&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">,</span><span class="string">&#x27;:&#x27;</span><span class="punctuation">,</span>sep<span class="operator">=</span><span class="string">&#x27;-&#x27;</span><span class="punctuation">)</span>  <span class="comment"># &quot;a-1-:&quot; &quot;b-1-:&quot; &quot;c-1-:&quot;，使用sep连接</span></span><br><span class="line">str_c<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;a&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;b&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;c&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span><span class="string">&#x27;:&#x27;</span><span class="punctuation">,</span>sep<span class="operator">=</span><span class="string">&#x27;-&#x27;</span><span class="punctuation">,</span>collapse <span class="operator">=</span> <span class="string">&#x27;&#x27;</span><span class="punctuation">)</span>  <span class="comment"># &quot;a-:b-:c-:&quot;，拼接完成后将所有字符串连接在一起</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># str_glue格式化并使用glue插入一个字符串</span></span><br><span class="line">name <span class="operator">&lt;-</span> <span class="string">&quot;Fred&quot;</span></span><br><span class="line">anniversary <span class="operator">&lt;-</span> as.Date<span class="punctuation">(</span><span class="string">&quot;1991-10-12&quot;</span><span class="punctuation">)</span></span><br><span class="line">str_glue<span class="punctuation">(</span></span><br><span class="line">  <span class="string">&quot;My name is &#123;name&#125;, &quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="string">&quot;and my anniversary is &#123;format(anniversary, &#x27;%A, %B %d, %Y&#x27;)&#125;.&quot;</span></span><br><span class="line"><span class="punctuation">)</span>  <span class="comment"># My name is Fred, and my anniversary is Saturday, October 12, 1991.</span></span><br><span class="line">mtcars <span class="operator">%&gt;%</span> str_glue_data<span class="punctuation">(</span><span class="string">&quot;&#123;rownames(.)&#125; has &#123;hp&#125; hp&quot;</span><span class="punctuation">)</span>  <span class="comment"># 针对dataframe的字符串格式化，按行输出</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># str_locate定位子串在字符串中的位置，返回一个列表</span></span><br><span class="line">fruit <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;apple&quot;</span><span class="punctuation">,</span> <span class="string">&quot;banana&quot;</span><span class="punctuation">,</span> <span class="string">&quot;pear&quot;</span><span class="punctuation">,</span> <span class="string">&quot;pineapple&quot;</span><span class="punctuation">)</span></span><br><span class="line">str_locate<span class="punctuation">(</span>fruit<span class="punctuation">,</span> <span class="string">&quot;$&quot;</span><span class="punctuation">)</span></span><br><span class="line">str_locate<span class="punctuation">(</span>fruit<span class="punctuation">,</span> <span class="string">&quot;a&quot;</span><span class="punctuation">)</span></span><br><span class="line">str_locate<span class="punctuation">(</span>fruit<span class="punctuation">,</span> <span class="string">&quot;e&quot;</span><span class="punctuation">)</span></span><br><span class="line">str_locate<span class="punctuation">(</span>fruit<span class="punctuation">,</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;a&quot;</span><span class="punctuation">,</span> <span class="string">&quot;b&quot;</span><span class="punctuation">,</span> <span class="string">&quot;p&quot;</span><span class="punctuation">,</span> <span class="string">&quot;p&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">str_locate_all<span class="punctuation">(</span>fruit<span class="punctuation">,</span> <span class="string">&quot;a&quot;</span><span class="punctuation">)</span>  <span class="comment"># 返回子串所在的所有位置</span></span><br><span class="line">str_locate_all<span class="punctuation">(</span>fruit<span class="punctuation">,</span> <span class="string">&quot;e&quot;</span><span class="punctuation">)</span></span><br><span class="line">str_locate_all<span class="punctuation">(</span>fruit<span class="punctuation">,</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;a&quot;</span><span class="punctuation">,</span> <span class="string">&quot;b&quot;</span><span class="punctuation">,</span> <span class="string">&quot;p&quot;</span><span class="punctuation">,</span> <span class="string">&quot;p&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># str_remove删掉匹配到的子串，支持正则表达式</span></span><br><span class="line">fruits <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;one apple&quot;</span><span class="punctuation">,</span> <span class="string">&quot;two pears&quot;</span><span class="punctuation">,</span> <span class="string">&quot;three bananas&quot;</span><span class="punctuation">)</span></span><br><span class="line">str_remove<span class="punctuation">(</span>fruits<span class="punctuation">,</span> <span class="string">&quot;[aeiou]&quot;</span><span class="punctuation">)</span>  <span class="comment"># &quot;ne apple&quot;     &quot;tw pears&quot;     &quot;thre bananas&quot;</span></span><br><span class="line">str_remove_all<span class="punctuation">(</span>fruits<span class="punctuation">,</span> <span class="string">&quot;[aeiou]&quot;</span><span class="punctuation">)</span>  <span class="comment"># &quot;n ppl&quot;    &quot;tw prs&quot;   &quot;thr bnns&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># str_trunc截断一个字符串</span></span><br><span class="line">x <span class="operator">&lt;-</span> <span class="string">&quot;This string is moderately long&quot;</span></span><br><span class="line">rbind<span class="punctuation">(</span></span><br><span class="line">  str_trunc<span class="punctuation">(</span>x<span class="punctuation">,</span> <span class="number">20</span><span class="punctuation">,</span> <span class="string">&quot;right&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span>  <span class="comment"># &quot;This string is mo...&quot;</span></span><br><span class="line">  str_trunc<span class="punctuation">(</span>x<span class="punctuation">,</span> <span class="number">20</span><span class="punctuation">,</span> <span class="string">&quot;left&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span>  <span class="comment"># &quot;...s moderately long&quot;</span></span><br><span class="line">  str_trunc<span class="punctuation">(</span>x<span class="punctuation">,</span> <span class="number">20</span><span class="punctuation">,</span> <span class="string">&quot;center&quot;</span><span class="punctuation">)</span>  <span class="comment"># &quot;This stri...ely long&quot;</span></span><br><span class="line"><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">str_to_upper<span class="punctuation">(</span><span class="string">&#x27;asd asd qafdwe&#x27;</span><span class="punctuation">)</span>  <span class="comment"># &quot;ASD ASD QAFDWE&quot;，转换为大写</span></span><br><span class="line">str_to_title<span class="punctuation">(</span><span class="string">&#x27;qweq wer wr&#x27;</span><span class="punctuation">)</span>  <span class="comment"># &quot;Qweq Wer Wr&quot;，首字母转换为大写</span></span><br><span class="line">regex<span class="punctuation">(</span><span class="string">&#x27;[0-9]&#x27;</span><span class="punctuation">)</span>  <span class="comment"># 生成正则表达式，有些函数支持输入正则表达式，就不用这个了</span></span><br><span class="line">str_dup<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;ab&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;bc&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;cd&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">)</span>  <span class="comment"># &quot;abab&quot; &quot;bcbc&quot; &quot;cdcd&quot;，重复每个元素指定次数</span></span><br><span class="line">str_ends<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;abc&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;abe&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;cde&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="string">&#x27;e&#x27;</span><span class="punctuation">)</span>  <span class="comment"># FALSE  TRUE  TRUE，检查字符串结尾是否为某个子字符串</span></span><br><span class="line">str_starts<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;abc&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;abe&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;cde&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="string">&#x27;a&#x27;</span><span class="punctuation">)</span>  <span class="comment"># TRUE  TRUE  FALSE，检查字符串开头是否为某个子字符串</span></span><br><span class="line">str_flatten<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;a&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;b&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;c&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span>  <span class="comment"># &quot;abc&quot;，将字符串从头到尾全部连接起来，可以指定collapse相当于sep</span></span><br><span class="line">str_length<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;i&quot;</span><span class="punctuation">,</span> <span class="string">&quot;like&quot;</span><span class="punctuation">,</span> <span class="literal">NA</span><span class="punctuation">)</span><span class="punctuation">)</span>  <span class="comment"># 1  4 NA，返回字符串的长度</span></span><br><span class="line">str_order<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;b&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;c&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;a&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span>  <span class="comment"># 3 1 2，按字符索引进行排序</span></span><br><span class="line">str_sort<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;b&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;c&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;a&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span>  <span class="comment"># &quot;a&quot; &quot;b&quot; &quot;c&quot;，对字符进行排序</span></span><br><span class="line">str_replace<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;abc&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;bca&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;ccc&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;bbb&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span><span class="string">&#x27;b&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;-&#x27;</span><span class="punctuation">)</span>  <span class="comment"># &quot;a-c&quot; &quot;-ca&quot; &quot;ccc&quot; &quot;-bb&quot;，替换第一个字符</span></span><br><span class="line">str_replace_all<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;abc&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;bca&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;ccc&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;bbb&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span><span class="string">&#x27;b&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;-&#x27;</span><span class="punctuation">)</span>  <span class="comment"># &quot;a-c&quot; &quot;-ca&quot; &quot;ccc&quot; &quot;---&quot;，替换所有字符</span></span><br><span class="line">str_replace_na<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="literal">NA</span><span class="punctuation">,</span> <span class="string">&quot;abc&quot;</span><span class="punctuation">,</span> <span class="string">&quot;def&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span><span class="string">&#x27;ccc&#x27;</span><span class="punctuation">)</span>  <span class="comment"># &quot;ccc&quot; &quot;abc&quot; &quot;def&quot;，替换空值</span></span><br><span class="line">str_trim<span class="punctuation">(</span><span class="string">&#x27; qwe &#x27;</span><span class="punctuation">)</span>  <span class="comment"># &quot;qwe&quot;，默认删掉字符串两边空格，可以指定side为left或者right</span></span><br><span class="line">str_pad<span class="punctuation">(</span>string<span class="operator">=</span><span class="string">&#x27;abc&#x27;</span><span class="punctuation">,</span> side<span class="operator">=</span><span class="string">&#x27;both&#x27;</span><span class="punctuation">,</span> width<span class="operator">=</span><span class="string">&#x27;10&#x27;</span><span class="punctuation">,</span> pad<span class="operator">=</span><span class="string">&#x27;-&#x27;</span><span class="punctuation">)</span>  <span class="comment"># &quot;---abc----&quot;，字符串填充</span></span><br><span class="line">str_squish<span class="punctuation">(</span><span class="string">&quot;\t \n\nString \n space\n\n &quot;</span><span class="punctuation">)</span>  <span class="comment"># &quot;String space&quot;，删掉字符串中的无用字符（空格、换行等）</span></span><br><span class="line">str_sub<span class="punctuation">(</span><span class="string">&#x27;string&#x27;</span><span class="punctuation">,</span> start<span class="operator">=</span><span class="number">1L</span><span class="punctuation">,</span> end<span class="operator">=</span><span class="number">3</span><span class="punctuation">)</span>  <span class="comment"># &quot;str&quot;，根据位置截取字符串，end为-1截取所有字符串</span></span><br></pre></td></tr></table></figure>

<h3 id="openxlsx包"><a href="#openxlsx包" class="headerlink" title="openxlsx包"></a>openxlsx包</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># writeData写入数据到工作不对象的sheet中，以及常用的参数，write.xlsx直接写入文件</span></span><br><span class="line">writeData<span class="punctuation">(</span>wb<span class="punctuation">,</span><span class="string">&#x27;ss&#x27;</span><span class="punctuation">,</span>dd<span class="punctuation">)</span>  <span class="comment"># 普通的写入</span></span><br><span class="line">writeData<span class="punctuation">(</span></span><br><span class="line">  wb<span class="punctuation">,</span>  <span class="comment"># 工作簿对象</span></span><br><span class="line">  sheet<span class="punctuation">,</span>  <span class="comment"># sheet名字</span></span><br><span class="line">  x<span class="punctuation">,</span>  <span class="comment"># 数据</span></span><br><span class="line">  startCol <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span>  <span class="comment"># 数据写入的开始列</span></span><br><span class="line">  startRow <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span>  <span class="comment"># 开始行</span></span><br><span class="line">  colNames <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span>  <span class="comment"># 是否包含列名</span></span><br><span class="line">  rowNames <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span>  <span class="comment"># 是否包含行名</span></span><br><span class="line">  headerStyle <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">,</span>  <span class="comment"># columns的自定义样式，插入一个addStyle样式</span></span><br><span class="line">  borders <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;none&quot;</span><span class="punctuation">,</span> <span class="string">&quot;surrounding&quot;</span><span class="punctuation">,</span> <span class="string">&quot;rows&quot;</span><span class="punctuation">,</span> <span class="string">&quot;columns&quot;</span><span class="punctuation">,</span> <span class="string">&quot;all&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span>  <span class="comment"># 四周边框</span></span><br><span class="line">  borderColour <span class="operator">=</span> getOption<span class="punctuation">(</span><span class="string">&quot;openxlsx.borderColour&quot;</span><span class="punctuation">,</span> <span class="string">&quot;black&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span>  <span class="comment"># 边框颜色</span></span><br><span class="line">  borderStyle <span class="operator">=</span> getOption<span class="punctuation">(</span><span class="string">&quot;openxlsx.borderStyle&quot;</span><span class="punctuation">,</span> <span class="string">&quot;thin&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span>  <span class="comment"># 边框样式</span></span><br><span class="line">  na.string <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">,</span>  <span class="comment"># 若有NA值，则全部填充为这个值</span></span><br><span class="line"><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># createStyle新建样式，在插入数据的时候使用</span></span><br><span class="line">createStyle<span class="punctuation">(</span></span><br><span class="line">  fontName <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">,</span>  <span class="comment"># 字体名称</span></span><br><span class="line">  fontSize <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">,</span>  <span class="comment"># 字体大小</span></span><br><span class="line">  fontColour <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">,</span>  <span class="comment"># 字体颜色</span></span><br><span class="line">  numFmt <span class="operator">=</span> <span class="string">&quot;GENERAL&quot;</span><span class="punctuation">,</span>  <span class="comment"># 格式化数据</span></span><br><span class="line">  border <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">,</span>  <span class="comment"># 四周边框</span></span><br><span class="line">  borderColour <span class="operator">=</span> getOption<span class="punctuation">(</span><span class="string">&quot;openxlsx.borderColour&quot;</span><span class="punctuation">,</span> <span class="string">&quot;black&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span>  <span class="comment"># 边框颜色</span></span><br><span class="line">  borderStyle <span class="operator">=</span> getOption<span class="punctuation">(</span><span class="string">&quot;openxlsx.borderStyle&quot;</span><span class="punctuation">,</span> <span class="string">&quot;thin&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span>  <span class="comment"># 边框样式</span></span><br><span class="line">  bgFill <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">,</span>  <span class="comment"># 单元格背景颜色</span></span><br><span class="line">  halign <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">,</span>  <span class="comment"># 单元格内容的水平对齐（left、right、center）</span></span><br><span class="line">  valign <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">,</span>  <span class="comment"># 单元格内容的垂直对齐（top、center、bottom）</span></span><br><span class="line">  wrapText <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span>  <span class="comment"># 若为TRUE则单元格内自动换行</span></span><br><span class="line">  indent <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">,</span>  <span class="comment"># 缩进</span></span><br><span class="line">  locked <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">,</span>  <span class="comment"># 锁定单元格</span></span><br><span class="line">  hidden <span class="operator">=</span> <span class="literal">NULL</span>  <span class="comment"># 隐藏单元格内容的公式</span></span><br><span class="line"><span class="punctuation">)</span></span><br><span class="line">headerStyle <span class="operator">&lt;-</span> createStyle<span class="punctuation">(</span></span><br><span class="line">  fontSize <span class="operator">=</span> <span class="number">14</span><span class="punctuation">,</span> fontColour <span class="operator">=</span> <span class="string">&quot;#FFFFFF&quot;</span><span class="punctuation">,</span> numFmt <span class="operator">=</span> <span class="string">&quot;0.00%&quot;</span><span class="punctuation">,</span> halign <span class="operator">=</span> <span class="string">&quot;center&quot;</span><span class="punctuation">,</span></span><br><span class="line">  fgFill <span class="operator">=</span> <span class="string">&quot;#4F81BD&quot;</span><span class="punctuation">,</span> border <span class="operator">=</span> <span class="string">&quot;TopBottom&quot;</span><span class="punctuation">,</span> borderColour <span class="operator">=</span> <span class="string">&quot;#4F81BD&quot;</span></span><br><span class="line"><span class="punctuation">)</span></span><br><span class="line">addStyle<span class="punctuation">(</span>wb<span class="punctuation">,</span> sheet<span class="operator">=</span><span class="number">1</span><span class="punctuation">,</span> headerStyle<span class="punctuation">,</span> rows<span class="operator">=</span><span class="number">1</span><span class="punctuation">,</span> cols<span class="operator">=</span><span class="number">1</span><span class="operator">:</span><span class="number">6</span><span class="punctuation">,</span> gridExpand<span class="operator">=</span><span class="literal">TRUE</span><span class="punctuation">)</span>  <span class="comment"># 使用样式</span></span><br><span class="line">writeData<span class="punctuation">(</span>wb<span class="punctuation">,</span><span class="string">&#x27;ss&#x27;</span><span class="punctuation">,</span>dd<span class="punctuation">,</span>headerStyle<span class="operator">=</span>headerStyle<span class="punctuation">)</span>  <span class="comment"># 使用样式</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># read.xlsx从本地读取excel数据</span></span><br><span class="line">read.xlsx<span class="punctuation">(</span></span><br><span class="line">  xlsxFile<span class="punctuation">,</span>  <span class="comment"># 数据路径</span></span><br><span class="line">  sheet <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span>  <span class="comment"># sheet名称</span></span><br><span class="line">  startRow <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span>  <span class="comment"># 开始行</span></span><br><span class="line">  colNames <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span>  <span class="comment"># 是否包含列名</span></span><br><span class="line">  rowNames <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span>  <span class="comment"># 是否包含行名</span></span><br><span class="line">  detectDates <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span>  <span class="comment"># 若为真，则会将日期转换为日期格式</span></span><br><span class="line">  skipEmptyRows <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span>  <span class="comment"># 跳过空行</span></span><br><span class="line">  skipEmptyCols <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span>  <span class="comment"># 跳过空列</span></span><br><span class="line">  rows <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">,</span>  <span class="comment"># 默认读取所有的，可以指定读取指定的行</span></span><br><span class="line">  cols <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">,</span>  <span class="comment"># 默认读取所有的，可以指定读取指定的列</span></span><br><span class="line">  na.strings <span class="operator">=</span> <span class="string">&quot;NA&quot;</span><span class="punctuation">,</span>  <span class="comment"># 空白单元格的返回值，默认返回NA</span></span><br><span class="line">  fillMergedCells <span class="operator">=</span> <span class="literal">FALSE</span>  <span class="comment"># 如果为真，拆分合并的单元格并分到各单元格</span></span><br><span class="line"><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">createWorkbook<span class="punctuation">(</span><span class="punctuation">)</span>  <span class="comment"># 新建一个工作簿对象，可在对象内插入sheet，工具</span></span><br><span class="line">loadWorkbook<span class="punctuation">(</span>filepath<span class="punctuation">)</span>  <span class="comment"># 加载一个现有的.xlsx文件，生成工作簿对象</span></span><br><span class="line">saveWorkbook<span class="punctuation">(</span>wb<span class="punctuation">,</span> file<span class="punctuation">,</span> overwrite <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span>  <span class="comment"># 保存工作簿对象到文件，若存在不会覆盖会报错</span></span><br><span class="line">addWorksheet<span class="punctuation">(</span>wb<span class="punctuation">,</span><span class="string">&#x27;sheet&#x27;</span><span class="punctuation">)</span>  <span class="comment"># 向工作簿对象添加一个空白sheet，更多参数查看help</span></span><br><span class="line">addStyle<span class="punctuation">(</span>wb<span class="punctuation">,</span> sheet<span class="operator">=</span><span class="number">1</span><span class="punctuation">,</span> headerStyle<span class="punctuation">,</span> rows<span class="operator">=</span><span class="number">1</span><span class="punctuation">,</span> cols<span class="operator">=</span><span class="number">1</span><span class="operator">:</span><span class="number">6</span><span class="punctuation">,</span> gridExpand<span class="operator">=</span><span class="literal">TRUE</span><span class="punctuation">)</span>  <span class="comment"># 直接向工作簿对象添加样式</span></span><br><span class="line">createComment<span class="punctuation">(</span>comment <span class="operator">=</span> <span class="string">&quot;this is comment&quot;</span><span class="punctuation">)</span>  <span class="comment"># 新建一个注释，也有其他参数可以设置</span></span><br><span class="line">writeComment<span class="punctuation">(</span>wb<span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">,</span> col<span class="operator">=</span><span class="string">&quot;B&quot;</span><span class="punctuation">,</span> row<span class="operator">=</span><span class="number">10</span><span class="punctuation">,</span> comment<span class="operator">=</span>c1<span class="punctuation">)</span>  <span class="comment"># 给指定单元格添加注释</span></span><br><span class="line">deleteData<span class="punctuation">(</span>wb<span class="punctuation">,</span>sheet<span class="operator">=</span><span class="number">1</span><span class="punctuation">,</span>cols<span class="operator">=</span><span class="number">3</span><span class="operator">:</span><span class="number">5</span><span class="punctuation">,</span>rows<span class="operator">=</span><span class="number">5</span><span class="operator">:</span><span class="number">7</span><span class="punctuation">,</span>gridExpand<span class="operator">=</span><span class="literal">TRUE</span><span class="punctuation">)</span> <span class="comment"># 删除数据，gridExpand为真删除范围内所有数据</span></span><br><span class="line">freezePane<span class="punctuation">(</span>wb<span class="punctuation">,</span> <span class="string">&quot;Sheet 1&quot;</span><span class="punctuation">,</span> firstActiveRow <span class="operator">=</span> <span class="number">5</span><span class="punctuation">,</span> firstActiveCol <span class="operator">=</span> <span class="number">3</span><span class="punctuation">)</span>  <span class="comment"># 冻结单元格</span></span><br><span class="line">getSheetNames<span class="punctuation">(</span><span class="string">&#x27;/home/dingtao/wangxukun/data/tmp/alcon.xlsx&#x27;</span><span class="punctuation">)</span>  <span class="comment"># 返回本地excel文件的所有sheet名字</span></span><br><span class="line">mergeCells<span class="punctuation">(</span>wb<span class="punctuation">,</span> <span class="string">&quot;Sheet 1&quot;</span><span class="punctuation">,</span> cols <span class="operator">=</span> <span class="number">2</span><span class="punctuation">,</span> rows <span class="operator">=</span> <span class="number">3</span><span class="operator">:</span><span class="number">6</span><span class="punctuation">)</span>  <span class="comment"># 合并工作表中的单元格</span></span><br><span class="line">removeCellMerge<span class="punctuation">(</span>wb<span class="punctuation">,</span> <span class="string">&quot;Sheet 1&quot;</span><span class="punctuation">,</span> cols <span class="operator">=</span> <span class="number">2</span><span class="punctuation">,</span> rows <span class="operator">=</span> <span class="number">3</span><span class="operator">:</span><span class="number">6</span><span class="punctuation">)</span>  <span class="comment"># 拆分已合并的单元格</span></span><br><span class="line">sheets<span class="punctuation">(</span>wb<span class="punctuation">)</span>  <span class="comment"># 返回所有sheet名称</span></span><br><span class="line"><span class="built_in">names</span><span class="punctuation">(</span>wb<span class="punctuation">)</span>  <span class="comment"># 查看工作簿的所有sheet名字，可以修改sheet名字</span></span><br><span class="line">renameWorksheet<span class="punctuation">(</span>wb<span class="punctuation">,</span> <span class="string">&quot;Sheet 1&quot;</span><span class="punctuation">,</span> <span class="string">&quot;ss&quot;</span><span class="punctuation">)</span>  <span class="comment"># 修改sheet名称</span></span><br><span class="line">removeWorksheet<span class="punctuation">(</span>wb<span class="punctuation">,</span> <span class="string">&quot;Sheet 1&quot;</span><span class="punctuation">)</span>  <span class="comment"># 删除指定的sheet</span></span><br><span class="line">replaceStyle<span class="punctuation">(</span>wb<span class="punctuation">,</span> <span class="string">&quot;Sheet 1&quot;</span><span class="punctuation">,</span> newStyle <span class="operator">=</span> newStyle<span class="punctuation">)</span>  <span class="comment"># 替换已经存在的style</span></span><br><span class="line">setColWidths<span class="punctuation">(</span>wb<span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">,</span> cols<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">4</span><span class="punctuation">,</span> <span class="number">6</span><span class="punctuation">,</span> <span class="number">7</span><span class="punctuation">,</span><span class="punctuation">)</span><span class="punctuation">,</span> widths<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">16</span><span class="punctuation">,</span> <span class="number">15</span><span class="punctuation">,</span> <span class="number">12</span><span class="punctuation">,</span> <span class="number">18</span><span class="punctuation">)</span><span class="punctuation">)</span>  <span class="comment"># 设置工作表列宽度</span></span><br><span class="line">setRowHeights<span class="punctuation">(</span>wb<span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">,</span> rows<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">4</span><span class="punctuation">,</span> <span class="number">22</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">)</span><span class="punctuation">,</span> heights<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">24</span><span class="punctuation">,</span> <span class="number">28</span><span class="punctuation">,</span> <span class="number">32</span><span class="punctuation">,</span> <span class="number">42</span><span class="punctuation">)</span><span class="punctuation">)</span>  <span class="comment"># 设置工作表行高</span></span><br><span class="line">write.xlsx<span class="punctuation">(</span>dd<span class="punctuation">,</span> filepath<span class="punctuation">)</span>  <span class="comment"># 向excel文件写入datatable数据，或者是list，每个元素一个sheet</span></span><br></pre></td></tr></table></figure>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">WangXun</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://wangxukun.top/2020/08/22/Language/R语言常用包/">https://wangxukun.top/2020/08/22/Language/R语言常用包/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/R/">R</a></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2020/10/18/Software/ELK%E5%91%BD%E4%BB%A4%E8%AF%AD%E6%B3%95%E8%AF%A6%E8%A7%A3/"><i class="fa fa-chevron-left">  </i><span>ELK命令语法详解</span></a></div><div class="next-post pull-right"><a href="/2020/06/15/Mind/%E8%AE%BA%E5%8A%A0%E7%8F%AD%E7%9A%84%E6%84%8F%E4%B9%89/"><span>论加班的意义</span><i class="fa fa-chevron-right"></i></a></div></nav><div id="gitalk-container"></div><script>var gitalk = new Gitalk({
  clientID: 'aaf2844e0aeef4917c17',
  clientSecret: '10b96d24dffda7d3b4544778cf620f81990b676d',
  repo: 'blog-issue',
  owner: 'w749',
  admin: 'w749',
  id: md5(decodeURI(location.pathname)),
  language: 'en'
})
gitalk.render('gitalk-container')</script></div></div><footer class="footer-bg" style="background-image: url(/img/top-img.jpg)"><div class="layout" id="footer"><div class="copyright">&copy;2019 - 2022 By WangXun</div><div class="framework-info"><span>Driven - </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="footer_custom_text">hitokoto</div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-eye"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/lib/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.9.1"></script><script src="/js/fancybox.js?version=1.9.1"></script><script src="/js/sidebar.js?version=1.9.1"></script><script src="/js/copy.js?version=1.9.1"></script><script src="/js/fireworks.js?version=1.9.1"></script><script src="/js/transition.js?version=1.9.1"></script><script src="/js/scroll.js?version=1.9.1"></script><script src="/js/head.js?version=1.9.1"></script><script src="/js/search/algolia.js"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script><div class="search-dialog" id="algolia-search"><div class="search-dialog__title" id="algolia-search-title">Algolia</div><div id="algolia-input-panel"><div id="algolia-search-input"></div></div><hr><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-stats"></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>